<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘å¸ƒè¯é¢˜æµ‹è¯• - ç³å‡¯è’‚äºšè¯­</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="community.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 120px auto 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-align: center;
        }
        
        .test-button {
            display: inline-block;
            margin: 1rem;
            padding: 1rem 2rem;
            background: linear-gradient(45deg, #ffd700, #4ecdc4);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .instructions {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }
        
        .status-display {
            margin: 2rem 0;
            padding: 1rem;
            border-radius: 10px;
            font-family: monospace;
        }
        
        .status-success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .status-error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .status-info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">å‘å¸ƒè¯é¢˜æµ‹è¯•</span>
                    <span class="logo-english">Post Test</span>
                </div>
            </div>
            <div class="nav-extras">
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">ä¸ªäººä¸­å¿ƒ</a>
                        <a href="#" id="logoutLink">é€€å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="test-container">
        <h1>ğŸ§ª å‘å¸ƒè¯é¢˜åŠŸèƒ½æµ‹è¯•</h1>
        
        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <ol style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li>é¦–å…ˆç‚¹å‡»"ç™»å½•ç®¡ç†å‘˜"æŒ‰é’®è¿›è¡Œç™»å½•</li>
                <li>ç„¶åç‚¹å‡»"æµ‹è¯•å‘å¸ƒè¯é¢˜"æŒ‰é’®</li>
                <li>åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
                    <ul>
                        <li>âœ… æ£€æŸ¥å³ä¸Šè§’çš„ âŒ æŒ‰é’®æ˜¯å¦å¯ä»¥ç‚¹å‡»å…³é—­</li>
                        <li>âœ… å¡«å†™æ ‡é¢˜å’Œå†…å®¹ï¼Œç„¶åç‚¹å‡»"å‘å¸ƒè¯é¢˜"</li>
                        <li>âœ… éªŒè¯æ˜¯å¦æç¤ºæˆåŠŸæˆ–æ˜¾ç¤ºé”™è¯¯</li>
                    </ul>
                </li>
            </ol>
        </div>
        
        <div class="status-display" id="statusDisplay">
            <strong>ç³»ç»ŸçŠ¶æ€:</strong> ç­‰å¾…æµ‹è¯•...
        </div>
        
        <button class="test-button" onclick="loginAdmin()">ğŸ” ç™»å½•ç®¡ç†å‘˜</button>
        <button class="test-button" onclick="testPostModal()">ğŸ“ æµ‹è¯•å‘å¸ƒè¯é¢˜</button>
        <button class="test-button" onclick="checkStatus()">ğŸ” æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
        <button class="test-button" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</button>
        
        <div style="margin-top: 2rem;">
            <h3>ğŸ› é—®é¢˜è°ƒè¯•</h3>
            <button class="test-button" onclick="debugModal()">ğŸ”§ è°ƒè¯•æ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="testSimpleModal()">ğŸ¯ æµ‹è¯•ç®€å•æ¨¡æ€æ¡†</button>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>

    <script>
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusDisplay');
            statusDiv.className = `status-display status-${type}`;
            statusDiv.innerHTML = `<strong>çŠ¶æ€:</strong> ${message}`;
            console.log(`[çŠ¶æ€] ${message}`);
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('é¡µé¢åŠ è½½å®Œæˆï¼Œç­‰å¾…ç³»ç»Ÿåˆå§‹åŒ–...', 'info');
            
            setTimeout(() => {
                checkStatus();
            }, 1000);
        });

        // ç™»å½•ç®¡ç†å‘˜
        async function loginAdmin() {
            showStatus('æ­£åœ¨ç™»å½•ç®¡ç†å‘˜è´¦æˆ·...', 'info');
            
            if (!window.authSystem) {
                showStatus('âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½', 'error');
                return;
            }
            
            try {
                const result = await window.authSystem.login({
                    username: 'admin',
                    password: 'admin123'
                });
                
                if (result.success) {
                    showStatus(`âœ… ç®¡ç†å‘˜ç™»å½•æˆåŠŸ: ${window.authSystem.currentUser.username}`, 'success');
                } else {
                    showStatus(`âŒ ç™»å½•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ ç™»å½•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†
        function testPostModal() {
            showStatus('æ­£åœ¨æµ‹è¯•å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†...', 'info');
            
            try {
                if (typeof showNewPostModal === 'function') {
                    showNewPostModal();
                    showStatus('âœ… å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†å·²æ‰“å¼€ï¼Œè¯·æµ‹è¯•åŠŸèƒ½', 'success');
                } else {
                    showStatus('âŒ showNewPostModal å‡½æ•°æœªå®šä¹‰', 'error');
                }
            } catch (error) {
                showStatus(`âŒ æ¨¡æ€æ¡†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkStatus() {
            let status = [];
            
            // æ£€æŸ¥è®¤è¯ç³»ç»Ÿ
            if (window.authSystem) {
                if (window.authSystem.currentUser) {
                    status.push(`âœ… ç”¨æˆ·å·²ç™»å½•: ${window.authSystem.currentUser.username}`);
                } else {
                    status.push(`âš ï¸ ç”¨æˆ·æœªç™»å½•`);
                }
            } else {
                status.push(`âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½`);
            }
            
            // æ£€æŸ¥ç¤¾åŒºç³»ç»Ÿ
            if (window.communitySystem) {
                status.push(`âœ… ç¤¾åŒºç³»ç»Ÿå·²åŠ è½½`);
            } else {
                status.push(`âŒ ç¤¾åŒºç³»ç»ŸæœªåŠ è½½`);
            }
            
            // æ£€æŸ¥å…³é”®å‡½æ•°
            const functions = ['showNewPostModal', 'createModal', 'showModal', 'submitNewPost'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    status.push(`âœ… ${funcName} å‡½æ•°å¯ç”¨`);
                } else {
                    status.push(`âŒ ${funcName} å‡½æ•°ç¼ºå¤±`);
                }
            });
            
            showStatus(status.join('<br>'), status.some(s => s.includes('âŒ')) ? 'error' : 'success');
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (window.authSystem && window.authSystem.currentUser) {
                window.authSystem.logout();
                showStatus('âœ… å·²é€€å‡ºç™»å½•', 'info');
            } else {
                showStatus('âš ï¸ å½“å‰æœªç™»å½•', 'info');
            }
        }

        // è°ƒè¯•æ¨¡æ€æ¡†
        function debugModal() {
            showStatus('å¼€å§‹è°ƒè¯•æ¨¡æ€æ¡†...', 'info');
            
            // æ£€æŸ¥ç°æœ‰æ¨¡æ€æ¡†
            const existingModals = document.querySelectorAll('.modal');
            console.log('ç°æœ‰æ¨¡æ€æ¡†æ•°é‡:', existingModals.length);
            
            // æ‰‹åŠ¨åˆ›å»ºæµ‹è¯•æ¨¡æ€æ¡†
            try {
                const modal = createModal('debugModal', 'è°ƒè¯•æ¨¡æ€æ¡†', `
                    <div style="padding: 20px;">
                        <p>è¿™æ˜¯ä¸€ä¸ªè°ƒè¯•æ¨¡æ€æ¡†</p>
                        <button onclick="closeModal('debugModal')" class="btn btn-primary">å…³é—­</button>
                    </div>
                `);
                
                document.body.appendChild(modal);
                showModal('debugModal');
                showStatus('âœ… è°ƒè¯•æ¨¡æ€æ¡†å·²åˆ›å»ºå’Œæ˜¾ç¤º', 'success');
            } catch (error) {
                showStatus(`âŒ è°ƒè¯•æ¨¡æ€æ¡†åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•ç®€å•æ¨¡æ€æ¡†
        function testSimpleModal() {
            showStatus('æµ‹è¯•ç®€å•æ¨¡æ€æ¡†...', 'info');
            
            const simpleModal = document.createElement('div');
            simpleModal.id = 'simpleTestModal';
            simpleModal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0, 0, 0, 0.8);
                display: flex;
                justify-content: center;
                align-items: center;
                z-index: 10001;
            `;
            
            simpleModal.innerHTML = `
                <div style="background: linear-gradient(135deg, #1a237e, #3f51b5); padding: 30px; border-radius: 15px; max-width: 400px; color: white; text-align: center;">
                    <h3 style="color: #ffd700; margin-bottom: 20px;">ğŸ¯ ç®€å•æµ‹è¯•æ¨¡æ€æ¡†</h3>
                    <p style="margin-bottom: 20px;">å¦‚æœæ‚¨èƒ½çœ‹åˆ°æ­¤æ¨¡æ€æ¡†å¹¶èƒ½æˆåŠŸå…³é—­å®ƒï¼Œè¯´æ˜åŸºç¡€æ¨¡æ€æ¡†åŠŸèƒ½æ­£å¸¸ã€‚</p>
                    <button onclick="document.getElementById('simpleTestModal').remove()" style="background: #ffd700; color: #1a1a2e; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: bold;">âœ… å…³é—­æµ‹è¯•</button>
                </div>
            `;
            
            // ç‚¹å‡»èƒŒæ™¯å…³é—­
            simpleModal.addEventListener('click', (e) => {
                if (e.target === simpleModal) {
                    simpleModal.remove();
                }
            });
            
            document.body.appendChild(simpleModal);
            showStatus('âœ… ç®€å•æ¨¡æ€æ¡†å·²æ˜¾ç¤ºï¼Œè¯·å°è¯•å…³é—­', 'success');
        }
    </script>
</body>
</html>