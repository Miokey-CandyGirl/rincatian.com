<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†åŠŸèƒ½æµ‹è¯• - ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a237e; color: white; }
        .test-section { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px 0; border-radius: 10px; border: 1px solid rgba(255,215,0,0.3); }
        .test-button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #45a049; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: rgba(76,175,80,0.2); color: #4caf50; }
        .error { background: rgba(244,67,54,0.2); color: #f44336; }
        .info { background: rgba(33,150,243,0.2); color: #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸ› ï¸ ç®¡ç†åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ” ç®¡ç†å‘˜ç™»å½•æµ‹è¯•</h2>
        <button class="test-button" onclick="loginAsAdmin()">ç™»å½•ä¸ºç®¡ç†å‘˜</button>
        <button class="test-button" onclick="checkAdminAccess()">æ£€æŸ¥ç®¡ç†å‘˜æƒé™</button>
        <div id="loginStatus" class="status info">ç­‰å¾…ç™»å½•...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‘¥ ç”¨æˆ·ç®¡ç†æµ‹è¯•</h2>
        <button class="test-button" onclick="createTestUsers()">åˆ›å»ºæµ‹è¯•ç”¨æˆ·</button>
        <button class="test-button" onclick="testUserData()">æµ‹è¯•ç”¨æˆ·æ•°æ®æ˜¾ç¤º</button>
        <button class="test-button" onclick="openAdminPage()">æ‰“å¼€ç®¡ç†é¡µé¢</button>
        <div id="userStatus" class="status info">ç­‰å¾…åˆ›å»ºç”¨æˆ·...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡æµ‹è¯•</h2>
        <button class="test-button" onclick="createTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <button class="test-button" onclick="testAnalytics()">æµ‹è¯•æ•°æ®ç»Ÿè®¡</button>
        <div id="dataStatus" class="status info">ç­‰å¾…åˆ›å»ºæ•°æ®...</div>
    </div>

    <script src="auth-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    
    <script>
        function loginAsAdmin() {
            // æ¨¡æ‹Ÿç®¡ç†å‘˜ç™»å½•
            const adminUser = {
                id: 'admin-001',
                username: 'admin',
                email: 'admin@rincatian.com',
                role: 'admin',
                status: 'active',
                joinDate: Date.now() - 86400000 * 30,
                lastLogin: Date.now(),
                avatar: 'ğŸ‘‘'
            };
            
            localStorage.setItem('currentUser', JSON.stringify(adminUser));
            
            // æ›´æ–°è®¤è¯ç³»ç»Ÿ
            if (window.authSystem) {
                window.authSystem.currentUser = adminUser;
            }
            
            // ä¹Ÿåœ¨ linkaitiya_users ä¸­æ·»åŠ è¿™ä¸ªç®¡ç†å‘˜
            const users = JSON.parse(localStorage.getItem('linkaitiya_users') || '[]');
            if (!users.find(u => u.id === adminUser.id)) {
                users.push({ ...adminUser, password: 'hashed_admin123' });
                localStorage.setItem('linkaitiya_users', JSON.stringify(users));
            }
            
            document.getElementById('loginStatus').innerHTML = 'âœ… ç®¡ç†å‘˜ç™»å½•æˆåŠŸ';
            document.getElementById('loginStatus').className = 'status success';
        }
        
        function checkAdminAccess() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
            if (currentUser && currentUser.role === 'admin') {
                document.getElementById('loginStatus').innerHTML = 'âœ… ç®¡ç†å‘˜æƒé™éªŒè¯é€šè¿‡';
                document.getElementById('loginStatus').className = 'status success';
            } else {
                document.getElementById('loginStatus').innerHTML = 'âŒ éç®¡ç†å‘˜ç”¨æˆ·ï¼Œæƒé™ä¸è¶³';
                document.getElementById('loginStatus').className = 'status error';
            }
        }
        
        function createTestUsers() {
            const testUsers = [
                {
                    id: 'admin-001',
                    username: 'admin',
                    email: 'admin@rincatian.com',
                    role: 'admin',
                    status: 'active',
                    joinDate: Date.now() - 86400000 * 30,
                    lastLogin: Date.now(),
                    avatar: 'ğŸ‘‘'
                },
                {
                    id: 'user-001',
                    username: 'testuser',
                    email: 'testuser@example.com',
                    role: 'user',
                    status: 'active',
                    joinDate: Date.now() - 86400000 * 15,
                    lastLogin: Date.now() - 300000,
                    avatar: 'ğŸ§ª'
                },
                {
                    id: 'user-002',
                    username: 'linguist',
                    email: 'linguist@example.com',
                    role: 'moderator',
                    status: 'active',
                    joinDate: Date.now() - 86400000 * 45,
                    lastLogin: Date.now() - 600000,
                    avatar: 'ğŸ“š'
                },
                {
                    id: 'user-003',
                    username: 'newbie',
                    email: 'newbie@example.com',
                    role: 'user',
                    status: 'inactive',
                    joinDate: Date.now() - 86400000 * 3,
                    lastLogin: Date.now() - 86400000,
                    avatar: 'ğŸŒ±'
                }
            ];
            
            // ä¿å­˜ç”¨æˆ·æ•°æ®
            localStorage.setItem('users', JSON.stringify(testUsers));
            
            // åˆ›å»ºç”¨æˆ·æ´»åŠ¨æ•°æ®
            const userActivityData = {
                'admin-001': {
                    visitCount: 156,
                    lastIP: '192.168.1.100',
                    lastUserAgent: 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',
                    onlineTime: 7200000,
                    loginHistory: []
                },
                'user-001': {
                    visitCount: 89,
                    lastIP: '10.0.0.15',
                    lastUserAgent: 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36',
                    onlineTime: 3600000,
                    loginHistory: []
                },
                'user-002': {
                    visitCount: 234,
                    lastIP: '172.16.0.50',
                    lastUserAgent: 'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36',
                    onlineTime: 5400000,
                    loginHistory: []
                },
                'user-003': {
                    visitCount: 12,
                    lastIP: '192.168.1.200',
                    lastUserAgent: 'Mozilla/5.0 (iPhone; CPU iPhone OS 16_0 like Mac OS X) AppleWebKit/605.1.15',
                    onlineTime: 600000,
                    loginHistory: []
                }
            };
            
            localStorage.setItem('userActivityData', JSON.stringify(userActivityData));
            
            document.getElementById('userStatus').innerHTML = 'âœ… æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸ (4ä¸ªç”¨æˆ·)';
            document.getElementById('userStatus').className = 'status success';
        }
        
        function testUserData() {
            const users = JSON.parse(localStorage.getItem('users') || '[]');
            const activityData = JSON.parse(localStorage.getItem('userActivityData') || '{}');
            
            console.log('ç”¨æˆ·æ•°æ®:', users);
            console.log('æ´»åŠ¨æ•°æ®:', activityData);
            
            if (users.length > 0) {
                document.getElementById('userStatus').innerHTML = `âœ… ç”¨æˆ·æ•°æ®éªŒè¯æˆåŠŸ (${users.length}ä¸ªç”¨æˆ·ï¼ŒåŒ…å«æ´»åŠ¨ç»Ÿè®¡)`;
                document.getElementById('userStatus').className = 'status success';
            } else {
                document.getElementById('userStatus').innerHTML = 'âŒ ç”¨æˆ·æ•°æ®ä¸å­˜åœ¨ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•ç”¨æˆ·';
                document.getElementById('userStatus').className = 'status error';
            }
        }
        
        function createTestData() {
            // åˆ›å»ºè®¿é—®æ•°æ®
            const visitData = {
                total: 4567,
                today: 123,
                week: 856,
                month: 2341,
                ips: {
                    '192.168.1.100': { count: 234, lastVisit: Date.now() - 120000 },
                    '10.0.0.15': { count: 89, lastVisit: Date.now() - 300000 },
                    '172.16.0.50': { count: 145, lastVisit: Date.now() - 600000 }
                },
                pages: {
                    '/community.html': 456,
                    '/dictionary.html': 234,
                    '/grammar.html': 189
                },
                browsers: {
                    'Chrome': 65,
                    'Firefox': 20,
                    'Safari': 15
                }
            };
            
            localStorage.setItem('visitData', JSON.stringify(visitData));
            
            // åˆ›å»ºä¸€äº›ç¤¾åŒºå¸–å­æ•°æ®
            const communityPosts = [
                {
                    id: 'post-001',
                    title: 'ç³å‡¯è’‚äºšè¯­å­¦ä¹ å¿ƒå¾—',
                    content: 'åˆ†äº«ä¸€äº›å­¦ä¹ ç»éªŒ...',
                    author: { id: 'user-001', username: 'testuser' },
                    timestamp: Date.now() - 86400000,
                    likes: ['user-002'],
                    replyCount: 3
                },
                {
                    id: 'post-002',
                    title: 'è¯­æ³•é—®é¢˜è®¨è®º',
                    content: 'å…³äºåŠ¨è¯å˜ä½çš„é—®é¢˜...',
                    author: { id: 'user-002', username: 'linguist' },
                    timestamp: Date.now() - 172800000,
                    likes: ['user-001', 'admin-001'],
                    replyCount: 5
                }
            ];
            
            localStorage.setItem('communityPosts', JSON.stringify(communityPosts));
            
            document.getElementById('dataStatus').innerHTML = 'âœ… æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸ (è®¿é—®ç»Ÿè®¡ã€å¸–å­æ•°æ®)';
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function testAnalytics() {
            const visitData = JSON.parse(localStorage.getItem('visitData') || '{}');
            const posts = JSON.parse(localStorage.getItem('communityPosts') || '[]');
            
            if (visitData.total && posts.length > 0) {
                document.getElementById('dataStatus').innerHTML = `âœ… æ•°æ®ç»Ÿè®¡éªŒè¯æˆåŠŸ (æ€»è®¿é—®: ${visitData.total}, å¸–å­: ${posts.length}ä¸ª)`;
                document.getElementById('dataStatus').className = 'status success';
            } else {
                document.getElementById('dataStatus').innerHTML = 'âŒ æ•°æ®ç»Ÿè®¡ä¸å®Œæ•´ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ•°æ®';
                document.getElementById('dataStatus').className = 'status error';
            }
        }
        
        function openAdminPage() {
            window.open('/admin.html', '_blank');
        }
        
        // é¡µé¢åŠ è½½æ—¶è¿›è¡Œåˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç®¡ç†åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½');
        });
    </script>
</body>
</html>