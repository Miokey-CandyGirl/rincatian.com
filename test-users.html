<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户数据测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        .user-list {
            border: 1px solid #ccc;
            padding: 10px;
            margin: 10px 0;
        }
        .user-item {
            padding: 5px;
            border-bottom: 1px solid #eee;
        }
        button {
            padding: 10px 15px;
            margin: 5px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
            border-radius: 4px;
        }
        button:hover {
            background-color: #45a049;
        }
        .log {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-family: monospace;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>用户数据测试工具</h1>
        
        <div>
            <button onclick="loadUsers()">加载用户数据</button>
            <button onclick="addTestUser()">添加测试用户</button>
            <button onclick="clearLogs()">清空日志</button>
        </div>
        
        <div class="log" id="logArea">日志将显示在这里...</div>
        
        <h2>用户列表</h2>
        <div class="user-list" id="userList">
            点击"加载用户数据"按钮查看用户列表
        </div>
    </div>

    <script src="auth-system.js"></script>
    <script src="admin.js"></script>
    
    <script>
        // 日志函数
        function log(message) {
            const logArea = document.getElementById('logArea');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }
        
        // 清空日志
        function clearLogs() {
            document.getElementById('logArea').innerHTML = '';
        }
        
        // 加载用户数据
        function loadUsers() {
            log('开始加载用户数据...');
            
            try {
                // 创建管理员面板实例（如果不存在）
                if (!window.adminPanel) {
                    window.adminPanel = new AdminPanel();
                }
                
                // 获取用户数据
                const users = window.adminPanel.getUsersData();
                log(`成功获取 ${users.length} 个用户`);
                
                // 显示用户列表
                displayUsers(users);
            } catch (error) {
                log(`加载用户数据失败: ${error.message}`);
                console.error(error);
            }
        }
        
        // 显示用户列表
        function displayUsers(users) {
            const userList = document.getElementById('userList');
            userList.innerHTML = '';
            
            if (!users || users.length === 0) {
                userList.innerHTML = '暂无用户数据';
                return;
            }
            
            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'user-item';
                userDiv.innerHTML = `
                    <strong>${user.username}</strong> (${user.role})<br>
                    ID: ${user.id}<br>
                    邮箱: ${user.email || '未设置'}<br>
                    注册时间: ${user.joinDate ? new Date(user.joinDate).toLocaleString() : '未知'}
                `;
                userList.appendChild(userDiv);
            });
        }
        
        // 添加测试用户
        function addTestUser() {
            log('添加测试用户...');
            
            if (!window.authSystem) {
                log('认证系统未加载');
                return;
            }
            
            const testUser = {
                username: '测试用户' + Math.floor(Math.random() * 1000),
                email: `test${Math.floor(Math.random() * 1000)}@example.com`,
                password: 'Test123456',
                role: 'user'
            };
            
            window.authSystem.register(testUser)
                .then(result => {
                    if (result.success) {
                        log(`用户注册成功: ${result.user.username}`);
                        // 重新加载用户列表
                        loadUsers();
                    } else {
                        log(`用户注册失败: ${result.message}`);
                    }
                })
                .catch(error => {
                    log(`用户注册异常: ${error.message}`);
                });
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            log('用户数据测试工具已加载');
        });
    </script>
</body>
</html>