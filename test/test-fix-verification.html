<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†é¡µé¢ä¿®å¤éªŒè¯ - ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a237e; color: white; }
        .test-panel { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px 0; border-radius: 10px; border: 1px solid rgba(255,215,0,0.3); }
        .test-button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #45a049; }
        .test-output { background: #000; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 400px; overflow-y: auto; margin: 10px 0; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: rgba(76,175,80,0.2); color: #4caf50; }
        .error { background: rgba(244,67,54,0.2); color: #f44336; }
        .warning { background: rgba(255,152,0,0.2); color: #ff9800; }
        .info { background: rgba(33,150,243,0.2); color: #2196f3; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç®¡ç†é¡µé¢ä¿®å¤éªŒè¯</h1>
    
    <div class="test-panel">
        <h2>ğŸ› ï¸ ä¿®å¤éªŒè¯</h2>
        <button class="test-button" onclick="testTabClickEvents()">æµ‹è¯•æ ‡ç­¾ç‚¹å‡»äº‹ä»¶</button>
        <button class="test-button" onclick="testStatisticsUpdate()">æµ‹è¯•ç»Ÿè®¡æ•°æ®æ›´æ–°</button>
        <button class="test-button" onclick="testUserDataLoading()">æµ‹è¯•ç”¨æˆ·æ•°æ®åŠ è½½</button>
        <button class="test-button" onclick="simulateUserManagementClick()">æ¨¡æ‹Ÿç”¨æˆ·ç®¡ç†ç‚¹å‡»</button>
        <div id="testStatus" class="status info">ç­‰å¾…æµ‹è¯•...</div>
    </div>
    
    <div class="test-panel">
        <h2>ğŸ“Š æ•°æ®éªŒè¯</h2>
        <button class="test-button" onclick="checkUserData()">æ£€æŸ¥ç”¨æˆ·æ•°æ®</button>
        <button class="test-button" onclick="checkStatisticsElements()">æ£€æŸ¥ç»Ÿè®¡å…ƒç´ </button>
        <button class="test-button" onclick="checkTabElements()">æ£€æŸ¥æ ‡ç­¾å…ƒç´ </button>
        <div id="dataStatus" class="status info">ç­‰å¾…æ•°æ®éªŒè¯...</div>
    </div>
    
    <div class="test-panel">
        <h2>ğŸš€ å®Œæ•´æµ‹è¯•</h2>
        <button class="test-button" onclick="runCompleteTest()">è¿è¡Œå®Œæ•´æµ‹è¯•</button>
        <button class="test-button" onclick="openAdminPage()">æ‰“å¼€ç®¡ç†é¡µé¢</button>
        <div id="completeStatus" class="status info">ç­‰å¾…å®Œæ•´æµ‹è¯•...</div>
    </div>
    
    <div class="test-panel">
        <h2>ğŸ“‹ æµ‹è¯•è¾“å‡º</h2>
        <div class="test-output" id="testOutput">[ç³»ç»Ÿ] ä¿®å¤éªŒè¯å·¥å…·å·²å¯åŠ¨<br></div>
        <button class="test-button" onclick="clearOutput()">æ¸…ç©ºè¾“å‡º</button>
    </div>

    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = { 'success': '#00ff00', 'error': '#ff0000', 'warning': '#ffaa00', 'info': '#00ffff' };
            const color = colors[type] || '#ffffff';
            const outputElement = document.getElementById('testOutput');
            outputElement.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            outputElement.scrollTop = outputElement.scrollHeight;
        }
        
        function testTabClickEvents() {
            log('æµ‹è¯•æ ‡ç­¾ç‚¹å‡»äº‹ä»¶...', 'info');
            
            // æ£€æŸ¥æ˜¯å¦èƒ½æ‰¾åˆ°æ ‡ç­¾å…ƒç´ 
            const tabs = document.querySelectorAll('.admin-tab');
            log(`æ‰¾åˆ° ${tabs.length} ä¸ªæ ‡ç­¾å…ƒç´ `, tabs.length > 0 ? 'success' : 'error');
            
            // æ¨¡æ‹Ÿæ ‡ç­¾ç‚¹å‡»
            tabs.forEach((tab, index) => {
                const tabName = tab.dataset.tab;
                log(`æ ‡ç­¾ ${index + 1}: ${tab.textContent.trim()} (${tabName})`, 'info');
            });
            
            document.getElementById('testStatus').innerHTML = tabs.length > 0 ? 'âœ… æ ‡ç­¾å…ƒç´ æ£€æµ‹æ­£å¸¸' : 'âŒ æœªæ‰¾åˆ°æ ‡ç­¾å…ƒç´ ';
            document.getElementById('testStatus').className = tabs.length > 0 ? 'status success' : 'status error';
        }
        
        function testStatisticsUpdate() {
            log('æµ‹è¯•ç»Ÿè®¡æ•°æ®æ›´æ–°...', 'info');
            
            // æ£€æŸ¥ç»Ÿè®¡æ•°æ®å…ƒç´ 
            const statsElements = ['totalUsers', 'onlineUsers', 'totalVisits', 'todayVisits'];
            let foundElements = 0;
            
            statsElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    foundElements++;
                    log(`âœ… æ‰¾åˆ°ç»Ÿè®¡å…ƒç´ : ${id}`, 'success');
                } else {
                    log(`âŒ æœªæ‰¾åˆ°ç»Ÿè®¡å…ƒç´ : ${id}`, 'error');
                }
            });
            
            const status = foundElements === statsElements.length ? 'âœ… ç»Ÿè®¡å…ƒç´ å®Œæ•´' : `âš ï¸ ç¼ºå°‘ ${statsElements.length - foundElements} ä¸ªç»Ÿè®¡å…ƒç´ `;
            document.getElementById('testStatus').innerHTML = status;
            document.getElementById('testStatus').className = foundElements === statsElements.length ? 'status success' : 'status warning';
        }
        
        function testUserDataLoading() {
            log('æµ‹è¯•ç”¨æˆ·æ•°æ®åŠ è½½...', 'info');
            
            // æ£€æŸ¥localStorageä¸­çš„ç”¨æˆ·æ•°æ®
            const sources = ['users', 'linkaitiya_users'];
            let userData = null;
            
            for (const source of sources) {
                const data = localStorage.getItem(source);
                if (data) {
                    try {
                        userData = JSON.parse(data);
                        log(`âœ… ä» ${source} åŠ è½½åˆ° ${userData.length} ä¸ªç”¨æˆ·`, 'success');
                        break;
                    } catch (error) {
                        log(`âŒ è§£æ ${source} å¤±è´¥: ${error.message}`, 'error');
                    }
                }
            }
            
            if (!userData) {
                log('âš ï¸ æœªæ‰¾åˆ°ç”¨æˆ·æ•°æ®ï¼Œåˆ›å»ºæµ‹è¯•æ•°æ®...', 'warning');
                userData = [{
                    id: 'admin-test',
                    username: 'admin',
                    role: 'admin',
                    email: 'admin@rincatian.com',
                    status: 'active',
                    joinDate: Date.now()
                }];
                localStorage.setItem('linkaitiya_users', JSON.stringify(userData));
                log('âœ… æµ‹è¯•ç”¨æˆ·æ•°æ®åˆ›å»ºå®Œæˆ', 'success');
            }
            
            document.getElementById('dataStatus').innerHTML = `âœ… ç”¨æˆ·æ•°æ®éªŒè¯å®Œæˆ (${userData.length} ä¸ªç”¨æˆ·)`;
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function simulateUserManagementClick() {
            log('æ¨¡æ‹Ÿç”¨æˆ·ç®¡ç†æ ‡ç­¾ç‚¹å‡»...', 'info');
            
            // æŸ¥æ‰¾ç”¨æˆ·ç®¡ç†æ ‡ç­¾
            const userTab = document.querySelector('[data-tab="users"]');
            if (userTab) {
                log('âœ… æ‰¾åˆ°ç”¨æˆ·ç®¡ç†æ ‡ç­¾', 'success');
                
                // æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶
                const clickEvent = new MouseEvent('click', {
                    bubbles: true,
                    cancelable: true,
                    view: window
                });
                
                userTab.dispatchEvent(clickEvent);
                log('âœ… æ¨¡æ‹Ÿç‚¹å‡»äº‹ä»¶å·²è§¦å‘', 'success');
                
                document.getElementById('testStatus').innerHTML = 'âœ… ç”¨æˆ·ç®¡ç†æ ‡ç­¾ç‚¹å‡»æµ‹è¯•å®Œæˆ';
                document.getElementById('testStatus').className = 'status success';
            } else {
                log('âŒ æœªæ‰¾åˆ°ç”¨æˆ·ç®¡ç†æ ‡ç­¾', 'error');
                document.getElementById('testStatus').innerHTML = 'âŒ ç”¨æˆ·ç®¡ç†æ ‡ç­¾ä¸å­˜åœ¨';
                document.getElementById('testStatus').className = 'status error';
            }
        }
        
        function checkUserData() {
            log('æ£€æŸ¥ç”¨æˆ·æ•°æ®å®Œæ•´æ€§...', 'info');
            
            const users = JSON.parse(localStorage.getItem('linkaitiya_users') || '[]');
            
            if (users.length === 0) {
                log('âŒ ç”¨æˆ·æ•°æ®ä¸ºç©º', 'error');
                document.getElementById('dataStatus').innerHTML = 'âŒ ç”¨æˆ·æ•°æ®ä¸ºç©º';
                document.getElementById('dataStatus').className = 'status error';
                return;
            }
            
            const adminUsers = users.filter(u => u.role === 'admin');
            log(`ğŸ“Š æ€»ç”¨æˆ·æ•°: ${users.length}`, 'info');
            log(`ğŸ‘‘ ç®¡ç†å‘˜æ•°: ${adminUsers.length}`, 'info');
            
            users.forEach((user, index) => {
                log(`ç”¨æˆ· ${index + 1}: ${user.username} (${user.role})`, 'info');
            });
            
            document.getElementById('dataStatus').innerHTML = `âœ… ç”¨æˆ·æ•°æ®æ£€æŸ¥å®Œæˆ (${users.length} ä¸ªç”¨æˆ·, ${adminUsers.length} ä¸ªç®¡ç†å‘˜)`;
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function checkStatisticsElements() {
            log('æ£€æŸ¥ç»Ÿè®¡æ•°æ®å…ƒç´ ...', 'info');
            
            const requiredElements = [
                'totalUsers', 'onlineUsers', 'totalVisits', 'todayVisits',
                'totalWords', 'totalGrammar', 'totalPhrases'
            ];
            
            let foundCount = 0;
            
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    foundCount++;
                    log(`âœ… ${id}: å­˜åœ¨`, 'success');
                } else {
                    log(`âŒ ${id}: ä¸å­˜åœ¨`, 'error');
                }
            });
            
            const percentage = Math.round((foundCount / requiredElements.length) * 100);
            log(`ç»Ÿè®¡å…ƒç´ å®Œæ•´åº¦: ${percentage}% (${foundCount}/${requiredElements.length})`, foundCount === requiredElements.length ? 'success' : 'warning');
            
            document.getElementById('dataStatus').innerHTML = `ç»Ÿè®¡å…ƒç´ : ${percentage}% å®Œæ•´`;
            document.getElementById('dataStatus').className = foundCount === requiredElements.length ? 'status success' : 'status warning';
        }
        
        function checkTabElements() {
            log('æ£€æŸ¥æ ‡ç­¾é¡µå…ƒç´ ...', 'info');
            
            const tabButtons = document.querySelectorAll('.admin-tab');
            const tabSections = document.querySelectorAll('.admin-section');
            
            log(`æ‰¾åˆ° ${tabButtons.length} ä¸ªæ ‡ç­¾æŒ‰é’®`, 'info');
            log(`æ‰¾åˆ° ${tabSections.length} ä¸ªæ ‡ç­¾å†…å®¹åŒºåŸŸ`, 'info');
            
            tabButtons.forEach((btn, index) => {
                const tabName = btn.dataset.tab;
                const hasClickEvent = btn.onclick || btn.addEventListener;
                log(`æ ‡ç­¾ ${index + 1}: ${btn.textContent.trim()} -> ${tabName}`, 'info');
            });
            
            document.getElementById('dataStatus').innerHTML = `âœ… æ ‡ç­¾æ£€æŸ¥å®Œæˆ (${tabButtons.length} ä¸ªæ ‡ç­¾)`;
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function runCompleteTest() {
            log('ğŸš€ å¼€å§‹è¿è¡Œå®Œæ•´æµ‹è¯•...', 'info');
            
            setTimeout(() => testTabClickEvents(), 200);
            setTimeout(() => testStatisticsUpdate(), 800);
            setTimeout(() => testUserDataLoading(), 1400);
            setTimeout(() => checkUserData(), 2000);
            setTimeout(() => checkStatisticsElements(), 2600);
            setTimeout(() => checkTabElements(), 3200);
            setTimeout(() => simulateUserManagementClick(), 3800);
            
            setTimeout(() => {
                log('âœ… å®Œæ•´æµ‹è¯•æµç¨‹å·²å¯åŠ¨ï¼Œè¯·æŸ¥çœ‹å„é¡¹ç»“æœ', 'success');
                document.getElementById('completeStatus').innerHTML = 'âœ… å®Œæ•´æµ‹è¯•å·²å®Œæˆ';
                document.getElementById('completeStatus').className = 'status success';
            }, 4400);
        }
        
        function openAdminPage() {
            window.open('admin.html', '_blank');
            log('å·²æ‰“å¼€ç®¡ç†é¡µé¢è¿›è¡Œå®é™…æµ‹è¯•', 'info');
        }
        
        function clearOutput() {
            document.getElementById('testOutput').innerHTML = '';
            log('æµ‹è¯•è¾“å‡ºå·²æ¸…ç©º', 'info');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            log('ä¿®å¤éªŒè¯å·¥å…·åˆå§‹åŒ–å®Œæˆ', 'info');
            
            setTimeout(() => {
                testUserDataLoading();
                checkUserData();
            }, 1000);
        });
    </script>
</body>
</html>