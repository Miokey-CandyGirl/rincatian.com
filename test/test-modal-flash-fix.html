<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—ªé€€é—®é¢˜ä¿®å¤æµ‹è¯• - ç³å‡¯è’‚äºšè¯­</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="community.css">
    <style>
        .debug-container {
            max-width: 900px;
            margin: 120px auto 0;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(26, 26, 46, 0.9), rgba(22, 33, 62, 0.8));
            border-radius: 20px;
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .debug-title {
            text-align: center;
            color: #ffd700;
            font-size: 2rem;
            margin-bottom: 2rem;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border-left: 4px solid #4ecdc4;
        }
        
        .test-button {
            display: inline-block;
            margin: 0.5rem;
            padding: 1rem 1.5rem;
            background: linear-gradient(45deg, #ffd700, #4ecdc4);
            color: #1a1a2e;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
        }
        
        .test-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
        }
        
        .test-button:active {
            transform: translateY(-1px);
        }
        
        .test-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .test-button:active::before {
            width: 300px;
            height: 300px;
        }
        
        .log-container {
            margin: 2rem 0;
            padding: 1.5rem;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 300px;
            overflow-y: auto;
        }
        
        .log-item {
            margin: 0.5rem 0;
            padding: 0.75rem;
            border-left: 3px solid #4ecdc4;
            background: rgba(255, 255, 255, 0.05);
            font-family: 'Courier New', monospace;
            font-size: 0.9rem;
            border-radius: 5px;
        }
        
        .log-success { border-left-color: #00b894; color: #00b894; }
        .log-error { border-left-color: #e74c3c; color: #e74c3c; }
        .log-warning { border-left-color: #f39c12; color: #f39c12; }
        .log-info { border-left-color: #3498db; color: #3498db; }
        
        .status-badges {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }
        
        .status-badge {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 500;
        }
        
        .badge-success { background: rgba(0, 184, 148, 0.2); color: #00b894; border: 1px solid #00b894; }
        .badge-error { background: rgba(231, 76, 60, 0.2); color: #e74c3c; border: 1px solid #e74c3c; }
        .badge-warning { background: rgba(243, 156, 18, 0.2); color: #f39c12; border: 1px solid #f39c12; }
        
        .fix-highlights {
            background: linear-gradient(45deg, rgba(0, 184, 148, 0.1), rgba(116, 185, 255, 0.1));
            border: 1px solid rgba(0, 184, 148, 0.3);
            border-radius: 15px;
            padding: 1.5rem;
            margin: 2rem 0;
        }
        
        .scrollbar-custom::-webkit-scrollbar {
            width: 6px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb {
            background: rgba(255, 215, 0, 0.5);
            border-radius: 3px;
        }
        
        .scrollbar-custom::-webkit-scrollbar-thumb:hover {
            background: rgba(255, 215, 0, 0.7);
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">é—ªé€€ä¿®å¤æµ‹è¯•</span>
                    <span class="logo-english">Flash Fix Test</span>
                </div>
            </div>
            <div class="nav-extras">
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">ä¸ªäººä¸­å¿ƒ</a>
                        <a href="#" id="logoutLink">é€€å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="debug-container">
        <h1 class="debug-title">ğŸ”§ æ¨¡æ€æ¡†é—ªé€€é—®é¢˜ä¿®å¤æµ‹è¯•</h1>
        
        <div class="fix-highlights">
            <h3 style="color: #ffd700; margin-bottom: 1rem;">ğŸ¯ ä¿®å¤äº®ç‚¹</h3>
            <ul style="color: #e0e0e0; line-height: 1.8;">
                <li><strong>ğŸ›¡ï¸ é˜²æ­¢é‡å¤åˆ›å»º</strong>ï¼šå¢åŠ äº†ä¸¥æ ¼çš„æ¨¡æ€æ¡†é‡å¤æ£€æŸ¥å’Œæ¸…ç†æœºåˆ¶</li>
                <li><strong>âš¡ å¼‚æ­¥å¤„ç†</strong>ï¼šä½¿ç”¨setTimeouté¿å…DOMæ“ä½œå†²çª</li>
                <li><strong>ğŸ­ å¹³æ»‘åŠ¨ç”»</strong>ï¼šæ›¿æ¢å¯èƒ½å¯¼è‡´é—ªé€€çš„CSS animationä¸ºæ›´ç¨³å®šçš„transition</li>
                <li><strong>ğŸ”’ äº‹ä»¶éš”ç¦»</strong>ï¼šå¤šé‡äº‹ä»¶ç»‘å®šé˜²æŠ¤ï¼Œé˜²æ­¢äº‹ä»¶å†²çª</li>
                <li><strong>ğŸ§¹ å†…å­˜æ¸…ç†</strong>ï¼šå®Œå–„çš„äº‹ä»¶ç›‘å¬å™¨æ¸…ç†æœºåˆ¶</li>
                <li><strong>ğŸ“Š è°ƒè¯•æ—¥å¿—</strong>ï¼šè¯¦ç»†çš„æ§åˆ¶å°æ—¥å¿—å¸®åŠ©è¿½è¸ªé—®é¢˜</li>
            </ul>
        </div>
        
        <div class="test-section">
            <h3>ğŸš€ åŸºç¡€åŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" onclick="quickLogin()">âš¡ å¿«é€Ÿç™»å½•</button>
            <button class="test-button" onclick="testModalCreate()">ğŸ­ æµ‹è¯•æ¨¡æ€æ¡†åˆ›å»º</button>
            <button class="test-button" onclick="testModalClose()">âŒ æµ‹è¯•å…³é—­åŠŸèƒ½</button>
            <button class="test-button" onclick="checkSystemStatus()">ğŸ“Š ç³»ç»ŸçŠ¶æ€æ£€æŸ¥</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ”¥ å‹åŠ›æµ‹è¯•</h3>
            <button class="test-button" onclick="rapidClickTest()">ğŸ’¨ å¿«é€Ÿç‚¹å‡»æµ‹è¯•</button>
            <button class="test-button" onclick="multipleModalTest()">ğŸ”„ å¤šé‡æ¨¡æ€æ¡†æµ‹è¯•</button>
            <button class="test-button" onclick="escKeyTest()">âŒ¨ï¸ ESCé”®æµ‹è¯•</button>
            <button class="test-button" onclick="backgroundClickTest()">ğŸ¯ èƒŒæ™¯ç‚¹å‡»æµ‹è¯•</button>
        </div>
        
        <div class="test-section">
            <h3>ğŸ¯ ä¸“é¡¹è¯Šæ–­</h3>
            <button class="test-button" onclick="debugEvents()">ğŸ” äº‹ä»¶ç»‘å®šè¯Šæ–­</button>
            <button class="test-button" onclick="debugDOM()">ğŸŒ DOMçŠ¶æ€è¯Šæ–­</button>
            <button class="test-button" onclick="memoryLeakTest()">ğŸ§  å†…å­˜æ³„æ¼æµ‹è¯•</button>
            <button class="test-button" onclick="clearAllTests()">ğŸ§¹ æ¸…ç†æ‰€æœ‰æµ‹è¯•</button>
        </div>
        
        <div class="status-badges" id="statusBadges">
            <div class="status-badge badge-warning">ç­‰å¾…æµ‹è¯•...</div>
        </div>
        
        <div class="log-container scrollbar-custom">
            <h4 style="color: #ffd700; margin-bottom: 1rem;">ğŸ“‹ å®æ—¶æµ‹è¯•æ—¥å¿—</h4>
            <div id="testLog"></div>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>

    <script>
        let testCounter = 0;
        let testResults = {
            success: 0,
            error: 0,
            warning: 0
        };

        // æ—¥å¿—è®°å½•å‡½æ•°
        function log(message, type = 'info', showTime = true) {
            const logDiv = document.getElementById('testLog');
            const timestamp = showTime ? new Date().toLocaleTimeString() : '';
            
            const icons = {
                success: 'âœ…',
                error: 'âŒ',
                warning: 'âš ï¸',
                info: 'â„¹ï¸'
            };
            
            const icon = icons[type] || icons.info;
            
            const logItem = document.createElement('div');
            logItem.className = `log-item log-${type}`;
            logItem.innerHTML = `${timestamp ? `[${timestamp}] ` : ''}${icon} ${message}`;
            
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[æµ‹è¯•${++testCounter}] ${message}`);
            testResults[type]++;
            updateStatusBadges();
        }

        // æ›´æ–°çŠ¶æ€å¾½ç« 
        function updateStatusBadges() {
            const badgesDiv = document.getElementById('statusBadges');
            badgesDiv.innerHTML = `
                <div class="status-badge badge-success">æˆåŠŸ: ${testResults.success}</div>
                <div class="status-badge badge-error">é”™è¯¯: ${testResults.error}</div>
                <div class="status-badge badge-warning">è­¦å‘Š: ${testResults.warning}</div>
            `;
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('ğŸŒŸ é—ªé€€ä¿®å¤æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ', 'info');
            
            setTimeout(() => {
                checkSystemStatus();
            }, 1000);
        });

        // å¿«é€Ÿç™»å½•
        async function quickLogin() {
            log('æ­£åœ¨æ‰§è¡Œå¿«é€Ÿç™»å½•...', 'info');
            
            if (!window.authSystem) {
                log('è®¤è¯ç³»ç»ŸæœªåŠ è½½', 'error');
                return;
            }
            
            try {
                const result = await window.authSystem.login({
                    username: 'admin',
                    password: 'admin123'
                });
                
                if (result.success) {
                    log(`å¿«é€Ÿç™»å½•æˆåŠŸ: ${window.authSystem.currentUser.username}`, 'success');
                } else {
                    log(`ç™»å½•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`ç™»å½•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ¨¡æ€æ¡†åˆ›å»º
        function testModalCreate() {
            log('ğŸ­ å¼€å§‹æµ‹è¯•æ¨¡æ€æ¡†åˆ›å»º...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'warning');
                return;
            }
            
            try {
                // ç›‘å¬æ¨¡æ€æ¡†åˆ›å»ºè¿‡ç¨‹
                const originalConsoleLog = console.log;
                let createLogs = [];
                
                console.log = function(...args) {
                    const message = args.join(' ');
                    if (message.includes('ğŸŒŸ') || message.includes('ğŸ¯') || message.includes('âœ…') || message.includes('âŒ')) {
                        createLogs.push(message);
                    }
                    originalConsoleLog.apply(console, args);
                };
                
                showNewPostModal();
                
                setTimeout(() => {
                    console.log = originalConsoleLog;
                    
                    const modal = document.getElementById('newPostModal');
                    if (modal) {
                        log('æ¨¡æ€æ¡†åˆ›å»ºæˆåŠŸï¼ŒDOMå…ƒç´ å­˜åœ¨', 'success');
                        log(`æ•è·åˆ° ${createLogs.length} æ¡åˆ›å»ºæ—¥å¿—`, 'info');
                        createLogs.forEach(logMsg => log(logMsg, 'info', false));
                    } else {
                        log('æ¨¡æ€æ¡†åˆ›å»ºå¤±è´¥ï¼ŒDOMå…ƒç´ ä¸å­˜åœ¨', 'error');
                    }
                }, 500);
                
            } catch (error) {
                log(`æ¨¡æ€æ¡†åˆ›å»ºå¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å…³é—­åŠŸèƒ½
        function testModalClose() {
            log('âŒ å¼€å§‹æµ‹è¯•å…³é—­åŠŸèƒ½...', 'info');
            
            const modal = document.getElementById('newPostModal');
            if (!modal) {
                log('æ²¡æœ‰æ‰¾åˆ°æ‰“å¼€çš„æ¨¡æ€æ¡†', 'warning');
                return;
            }
            
            try {
                // æµ‹è¯•å…³é—­æŒ‰é’®
                const closeBtn = modal.querySelector('.close-modal-btn');
                if (closeBtn) {
                    log('æ‰¾åˆ°å…³é—­æŒ‰é’®ï¼Œæ¨¡æ‹Ÿç‚¹å‡»...', 'info');
                    closeBtn.click();
                    
                    setTimeout(() => {
                        const modalAfterClose = document.getElementById('newPostModal');
                        if (!modalAfterClose) {
                            log('å…³é—­æŒ‰é’®æµ‹è¯•æˆåŠŸï¼Œæ¨¡æ€æ¡†å·²ç§»é™¤', 'success');
                        } else {
                            log('å…³é—­æŒ‰é’®æµ‹è¯•å¤±è´¥ï¼Œæ¨¡æ€æ¡†ä»ç„¶å­˜åœ¨', 'error');
                        }
                    }, 500);
                } else {
                    log('æœªæ‰¾åˆ°å…³é—­æŒ‰é’®', 'error');
                }
            } catch (error) {
                log(`å…³é—­æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkSystemStatus() {
            log('ğŸ“Š æ£€æŸ¥ç³»ç»ŸçŠ¶æ€...', 'info');
            
            const checks = [
                { name: 'window.authSystem', obj: window.authSystem },
                { name: 'window.communitySystem', obj: window.communitySystem },
                { name: 'showNewPostModal å‡½æ•°', obj: window.showNewPostModal },
                { name: 'closeNewPostModal å‡½æ•°', obj: window.closeNewPostModal },
                { name: 'createNewPostModal å‡½æ•°', obj: window.createNewPostModal },
                { name: 'setupModalEvents å‡½æ•°', obj: window.setupModalEvents }
            ];
            
            checks.forEach(check => {
                if (check.obj) {
                    log(`${check.name} âœ… å·²åŠ è½½`, 'success');
                } else {
                    log(`${check.name} âŒ æœªåŠ è½½`, 'error');
                }
            });
            
            // æ£€æŸ¥ç”¨æˆ·ç™»å½•çŠ¶æ€
            if (window.authSystem?.currentUser) {
                log(`ç”¨æˆ·çŠ¶æ€: å·²ç™»å½• (${window.authSystem.currentUser.username})`, 'success');
            } else {
                log('ç”¨æˆ·çŠ¶æ€: æœªç™»å½•', 'warning');
            }
        }

        // å¿«é€Ÿç‚¹å‡»æµ‹è¯•
        function rapidClickTest() {
            log('ğŸ’¨ å¼€å§‹å¿«é€Ÿç‚¹å‡»æµ‹è¯•...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†è¿›è¡Œå‹åŠ›æµ‹è¯•', 'warning');
                return;
            }
            
            let clickCount = 0;
            const maxClicks = 5;
            
            function rapidClick() {
                if (clickCount >= maxClicks) {
                    log(`å¿«é€Ÿç‚¹å‡»æµ‹è¯•å®Œæˆï¼Œå…±æ‰§è¡Œ ${clickCount} æ¬¡ç‚¹å‡»`, 'success');
                    return;
                }
                
                clickCount++;
                log(`æ‰§è¡Œç¬¬ ${clickCount} æ¬¡å¿«é€Ÿç‚¹å‡»`, 'info');
                
                try {
                    showNewPostModal();
                    
                    setTimeout(() => {
                        const modal = document.getElementById('newPostModal');
                        if (modal) {
                            closeNewPostModal();
                        }
                        
                        setTimeout(rapidClick, 100);
                    }, 100);
                } catch (error) {
                    log(`ç¬¬ ${clickCount} æ¬¡ç‚¹å‡»å¼‚å¸¸: ${error.message}`, 'error');
                }
            }
            
            rapidClick();
        }

        // å¤šé‡æ¨¡æ€æ¡†æµ‹è¯•
        function multipleModalTest() {
            log('ğŸ”„ å¼€å§‹å¤šé‡æ¨¡æ€æ¡†æµ‹è¯•...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†è¿›è¡Œæµ‹è¯•', 'warning');
                return;
            }
            
            // å°è¯•åˆ›å»ºå¤šä¸ªæ¨¡æ€æ¡†
            for (let i = 1; i <= 3; i++) {
                setTimeout(() => {
                    log(`åˆ›å»ºç¬¬ ${i} ä¸ªæ¨¡æ€æ¡†...`, 'info');
                    showNewPostModal();
                    
                    setTimeout(() => {
                        const modals = document.querySelectorAll('#newPostModal');
                        log(`å½“å‰é¡µé¢ä¸­æ¨¡æ€æ¡†æ•°é‡: ${modals.length}`, modals.length === 1 ? 'success' : 'warning');
                    }, 200);
                }, i * 300);
            }
        }

        // ESCé”®æµ‹è¯•
        function escKeyTest() {
            log('âŒ¨ï¸ å¼€å§‹ESCé”®æµ‹è¯•...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'warning');
                return;
            }
            
            showNewPostModal();
            
            setTimeout(() => {
                const modal = document.getElementById('newPostModal');
                if (modal) {
                    log('æ¨¡æ‹ŸæŒ‰ä¸‹ESCé”®...', 'info');
                    
                    const escEvent = new KeyboardEvent('keydown', {
                        key: 'Escape',
                        keyCode: 27,
                        bubbles: true
                    });
                    
                    document.dispatchEvent(escEvent);
                    
                    setTimeout(() => {
                        const modalAfterEsc = document.getElementById('newPostModal');
                        if (!modalAfterEsc) {
                            log('ESCé”®æµ‹è¯•æˆåŠŸï¼Œæ¨¡æ€æ¡†å·²å…³é—­', 'success');
                        } else {
                            log('ESCé”®æµ‹è¯•å¤±è´¥ï¼Œæ¨¡æ€æ¡†ä»ç„¶å­˜åœ¨', 'error');
                        }
                    }, 500);
                } else {
                    log('æ¨¡æ€æ¡†åˆ›å»ºå¤±è´¥ï¼Œæ— æ³•æµ‹è¯•ESCé”®', 'error');
                }
            }, 300);
        }

        // èƒŒæ™¯ç‚¹å‡»æµ‹è¯•
        function backgroundClickTest() {
            log('ğŸ¯ å¼€å§‹èƒŒæ™¯ç‚¹å‡»æµ‹è¯•...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'warning');
                return;
            }
            
            showNewPostModal();
            
            setTimeout(() => {
                const modal = document.getElementById('newPostModal');
                if (modal) {
                    log('æ¨¡æ‹Ÿç‚¹å‡»æ¨¡æ€æ¡†èƒŒæ™¯...', 'info');
                    
                    const clickEvent = new MouseEvent('click', {
                        bubbles: true,
                        cancelable: true
                    });
                    
                    // ç¡®ä¿äº‹ä»¶ç›®æ ‡æ˜¯æ¨¡æ€æ¡†èƒŒæ™¯
                    Object.defineProperty(clickEvent, 'target', {
                        value: modal,
                        enumerable: true
                    });
                    
                    modal.dispatchEvent(clickEvent);
                    
                    setTimeout(() => {
                        const modalAfterClick = document.getElementById('newPostModal');
                        if (!modalAfterClick) {
                            log('èƒŒæ™¯ç‚¹å‡»æµ‹è¯•æˆåŠŸï¼Œæ¨¡æ€æ¡†å·²å…³é—­', 'success');
                        } else {
                            log('èƒŒæ™¯ç‚¹å‡»æµ‹è¯•å¤±è´¥ï¼Œæ¨¡æ€æ¡†ä»ç„¶å­˜åœ¨', 'error');
                        }
                    }, 500);
                } else {
                    log('æ¨¡æ€æ¡†åˆ›å»ºå¤±è´¥ï¼Œæ— æ³•æµ‹è¯•èƒŒæ™¯ç‚¹å‡»', 'error');
                }
            }, 300);
        }

        // äº‹ä»¶ç»‘å®šè¯Šæ–­
        function debugEvents() {
            log('ğŸ” å¼€å§‹äº‹ä»¶ç»‘å®šè¯Šæ–­...', 'info');
            
            const modal = document.getElementById('newPostModal');
            if (!modal) {
                log('æ²¡æœ‰æ‰¾åˆ°æ¨¡æ€æ¡†ï¼Œè¯·å…ˆåˆ›å»º', 'warning');
                return;
            }
            
            const closeBtn = modal.querySelector('.close-modal-btn');
            const cancelBtn = modal.querySelector('.btn-cancel');
            const submitBtn = modal.querySelector('.btn-submit');
            
            log(`å…³é—­æŒ‰é’®: ${closeBtn ? 'âœ… æ‰¾åˆ°' : 'âŒ ç¼ºå¤±'}`, closeBtn ? 'success' : 'error');
            log(`å–æ¶ˆæŒ‰é’®: ${cancelBtn ? 'âœ… æ‰¾åˆ°' : 'âŒ ç¼ºå¤±'}`, cancelBtn ? 'success' : 'error');
            log(`æäº¤æŒ‰é’®: ${submitBtn ? 'âœ… æ‰¾åˆ°' : 'âŒ ç¼ºå¤±'}`, submitBtn ? 'success' : 'error');
            
            // æ£€æŸ¥äº‹ä»¶ç›‘å¬å™¨
            if (closeBtn) {
                log(`å…³é—­æŒ‰é’®onclick: ${closeBtn.onclick ? 'âœ… å·²ç»‘å®š' : 'âŒ æœªç»‘å®š'}`, closeBtn.onclick ? 'success' : 'warning');
            }
            
            // æ£€æŸ¥ESCé”®ç›‘å¬å™¨
            log(`ESCé”®ç›‘å¬å™¨: ${modal._escKeyHandler ? 'âœ… å·²ç»‘å®š' : 'âŒ æœªç»‘å®š'}`, modal._escKeyHandler ? 'success' : 'warning');
        }

        // DOMçŠ¶æ€è¯Šæ–­
        function debugDOM() {
            log('ğŸŒ å¼€å§‹DOMçŠ¶æ€è¯Šæ–­...', 'info');
            
            const modals = document.querySelectorAll('#newPostModal');
            log(`é¡µé¢ä¸­æ¨¡æ€æ¡†æ•°é‡: ${modals.length}`, 'info');
            
            if (modals.length > 0) {
                modals.forEach((modal, index) => {
                    log(`æ¨¡æ€æ¡†${index + 1}: æ˜¾ç¤ºçŠ¶æ€=${modal.style.display}, é€æ˜åº¦=${modal.style.opacity}`, 'info');
                });
            }
            
            // æ£€æŸ¥bodyçš„overflowçŠ¶æ€
            log(`body overflow: ${document.body.style.overflow || 'auto'}`, 'info');
            
            // æ£€æŸ¥z-indexå±‚çº§
            const modal = document.getElementById('newPostModal');
            if (modal) {
                const zIndex = window.getComputedStyle(modal).zIndex;
                log(`æ¨¡æ€æ¡†z-index: ${zIndex}`, 'info');
            }
        }

        // å†…å­˜æ³„æ¼æµ‹è¯•
        function memoryLeakTest() {
            log('ğŸ§  å¼€å§‹å†…å­˜æ³„æ¼æµ‹è¯•...', 'info');
            
            if (!window.authSystem?.currentUser) {
                log('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'warning');
                return;
            }
            
            let modalCount = 0;
            
            function createAndDestroyModal() {
                if (modalCount >= 10) {
                    log('å†…å­˜æ³„æ¼æµ‹è¯•å®Œæˆï¼Œå…±åˆ›å»ºå’Œé”€æ¯10ä¸ªæ¨¡æ€æ¡†', 'success');
                    return;
                }
                
                modalCount++;
                log(`åˆ›å»ºå’Œé”€æ¯ç¬¬ ${modalCount} ä¸ªæ¨¡æ€æ¡†...`, 'info');
                
                showNewPostModal();
                
                setTimeout(() => {
                    closeNewPostModal();
                    
                    setTimeout(() => {
                        // æ£€æŸ¥æ˜¯å¦æœ‰æ®‹ç•™çš„äº‹ä»¶ç›‘å¬å™¨
                        const listeners = document._listeners || [];
                        log(`å½“å‰æ–‡æ¡£äº‹ä»¶ç›‘å¬å™¨æ•°é‡: ${listeners.length}`, 'info');
                        
                        setTimeout(createAndDestroyModal, 100);
                    }, 200);
                }, 100);
            }
            
            createAndDestroyModal();
        }

        // æ¸…ç†æ‰€æœ‰æµ‹è¯•
        function clearAllTests() {
            log('ğŸ§¹ æ¸…ç†æ‰€æœ‰æµ‹è¯•çŠ¶æ€...', 'info');
            
            // ç§»é™¤æ‰€æœ‰å¯èƒ½çš„æ¨¡æ€æ¡†
            const modals = document.querySelectorAll('#newPostModal');
            modals.forEach((modal, index) => {
                modal.remove();
                log(`å·²ç§»é™¤æ¨¡æ€æ¡† ${index + 1}`, 'success');
            });
            
            // æ¢å¤bodyçŠ¶æ€
            document.body.style.overflow = 'auto';
            
            // é‡ç½®æµ‹è¯•è®¡æ•°å™¨
            testCounter = 0;
            testResults = { success: 0, error: 0, warning: 0 };
            updateStatusBadges();
            
            // æ¸…ç©ºæ—¥å¿—
            document.getElementById('testLog').innerHTML = '';
            
            log('æ‰€æœ‰æµ‹è¯•çŠ¶æ€å·²æ¸…ç†å®Œæˆ', 'success');
        }
    </script>
</body>
</html>