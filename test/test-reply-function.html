<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›å¤åŠŸèƒ½æµ‹è¯• - ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a237e; color: white; }
        .test-section { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px 0; border-radius: 10px; border: 1px solid rgba(255,215,0,0.3); }
        .test-button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #45a049; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: rgba(76,175,80,0.2); color: #4caf50; }
        .error { background: rgba(244,67,54,0.2); color: #f44336; }
        .info { background: rgba(33,150,243,0.2); color: #2196f3; }
        .test-log { background: #000; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ’¬ å›å¤åŠŸèƒ½æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“ å‡†å¤‡æµ‹è¯•æ•°æ®</h2>
        <button class="test-button" onclick="createTestData()">åˆ›å»ºæµ‹è¯•å¸–å­å’Œå›å¤</button>
        <button class="test-button" onclick="loginTestUser()">ç™»å½•æµ‹è¯•ç”¨æˆ·</button>
        <div id="dataStatus" class="status info">ç­‰å¾…åˆ›å»ºæµ‹è¯•æ•°æ®...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ‘ï¸ æŸ¥çœ‹å¸–å­è¯¦æƒ…</h2>
        <button class="test-button" onclick="testViewPostDetail()">æŸ¥çœ‹å¸–å­è¯¦æƒ…</button>
        <div id="viewStatus" class="status info">ç‚¹å‡»æŒ‰é’®æµ‹è¯•æŸ¥çœ‹åŠŸèƒ½</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¬ å›å¤åŠŸèƒ½</h2>
        <button class="test-button" onclick="testReplySubmission()">æµ‹è¯•å›å¤æäº¤</button>
        <button class="test-button" onclick="testReplyDisplay()">æµ‹è¯•å›å¤æ˜¾ç¤º</button>
        <div id="replyStatus" class="status info">ç­‰å¾…æµ‹è¯•å›å¤åŠŸèƒ½...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•æ—¥å¿—</h2>
        <div class="test-log" id="testLog">[ç³»ç»Ÿ] å›å¤åŠŸèƒ½æµ‹è¯•é¡µé¢å·²åŠ è½½...<br></div>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = { 'success': '#00ff00', 'error': '#ff0000', 'warning': '#ffaa00', 'info': '#00ffff' };
            const color = colors[type] || '#ffffff';
            const logElement = document.getElementById('testLog');
            logElement.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function createTestData() {
            log('åˆ›å»ºæµ‹è¯•å¸–å­å’Œå›å¤æ•°æ®...', 'info');
            
            // åˆ›å»ºæµ‹è¯•å¸–å­
            const testPosts = [
                {
                    id: 'test-post-reply', 
                    title: 'ğŸŒŸ æµ‹è¯•å›å¤åŠŸèƒ½çš„å¸–å­', 
                    content: 'è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨æ¥æµ‹è¯•å›å¤åŠŸèƒ½çš„å¸–å­ã€‚å¤§å®¶å¯ä»¥åœ¨è¿™é‡Œæµ‹è¯•å‘è¡¨å›å¤ã€æŸ¥çœ‹å›å¤ç­‰åŠŸèƒ½ã€‚',
                    author: { id: 'test-user', username: 'testuser', displayName: 'æµ‹è¯•ç”¨æˆ·', avatar: 'ğŸ§ª' },
                    timestamp: Date.now() - 300000, 
                    likes: ['u1','u2'], 
                    replyCount: 2, 
                    replies: 2,
                    views: 25,
                    category: 'general',
                    tags: ['æµ‹è¯•', 'å›å¤']
                }
            ];
            
            // åˆ›å»ºæµ‹è¯•å›å¤
            const testReplies = [
                {
                    id: 'reply_test_1',
                    postId: 'test-post-reply',
                    authorId: 'other-user',
                    content: 'è¿™æ˜¯ç¬¬ä¸€æ¡æµ‹è¯•å›å¤ï¼å›å¤åŠŸèƒ½çœ‹èµ·æ¥ä¸é”™ã€‚',
                    parentReplyId: null,
                    timestamp: Date.now() - 120000,
                    likes: ['test-user'],
                    status: 'active'
                },
                {
                    id: 'reply_test_2',
                    postId: 'test-post-reply',
                    authorId: 'another-user',
                    content: 'æˆ‘ä¹Ÿæ¥æµ‹è¯•ä¸€ä¸‹å›å¤åŠŸèƒ½ï¼ŒæœŸå¾…çœ‹åˆ°æ›´å¤šäº’åŠ¨ï¼',
                    parentReplyId: null,
                    timestamp: Date.now() - 60000,
                    likes: [],
                    status: 'active'
                }
            ];
            
            // åˆ›å»ºæµ‹è¯•ç”¨æˆ·
            const testUsers = [
                { id: 'test-user', username: 'testuser', displayName: 'æµ‹è¯•ç”¨æˆ·', avatar: 'ğŸ§ª' },
                { id: 'other-user', username: 'otheruser', displayName: 'å…¶ä»–ç”¨æˆ·', avatar: 'ğŸ‘¤' },
                { id: 'another-user', username: 'anotheruser', displayName: 'å¦ä¸€ä¸ªç”¨æˆ·', avatar: 'ğŸ¤”' }
            ];
            
            localStorage.setItem('communityPosts', JSON.stringify(testPosts));
            localStorage.setItem('communityReplies', JSON.stringify(testReplies));
            localStorage.setItem('communityUsers', JSON.stringify(testUsers));
            
            log('âœ… æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸ - 1ä¸ªå¸–å­ï¼Œ2æ¡å›å¤', 'success');
            document.getElementById('dataStatus').innerHTML = 'âœ… æµ‹è¯•æ•°æ®å·²åˆ›å»º (1å¸–å­ + 2å›å¤)';
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function loginTestUser() {
            const testUser = { id: 'test-user', username: 'testuser', displayName: 'æµ‹è¯•ç”¨æˆ·', avatar: 'ğŸ§ª' };
            localStorage.setItem('currentUser', JSON.stringify(testUser));
            if (typeof communityData !== 'undefined') { 
                communityData.currentUser = testUser; 
            }
            log('âœ… æµ‹è¯•ç”¨æˆ·ç™»å½•æˆåŠŸ', 'success');
            document.getElementById('dataStatus').innerHTML = 'âœ… æµ‹è¯•ç”¨æˆ·å·²ç™»å½•';
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function testViewPostDetail() {
            log('æµ‹è¯•æŸ¥çœ‹å¸–å­è¯¦æƒ…...', 'info');
            if (typeof viewPostDetail === 'function') {
                viewPostDetail('test-post-reply');
                log('âœ… å¸–å­è¯¦æƒ…é¡µé¢å·²æ‰“å¼€', 'success');
                document.getElementById('viewStatus').innerHTML = 'âœ… è¯¦æƒ…é¡µé¢æ­£å¸¸æ‰“å¼€';
                document.getElementById('viewStatus').className = 'status success';
            } else {
                log('âŒ viewPostDetail å‡½æ•°æœªå®šä¹‰', 'error');
                document.getElementById('viewStatus').innerHTML = 'âŒ è¯¦æƒ…æŸ¥çœ‹åŠŸèƒ½å¼‚å¸¸';
                document.getElementById('viewStatus').className = 'status error';
            }
        }
        
        function testReplySubmission() {
            log('æµ‹è¯•å›å¤æäº¤åŠŸèƒ½...', 'info');
            
            // æ£€æŸ¥ç›¸å…³å‡½æ•°æ˜¯å¦å­˜åœ¨
            const functions = ['submitPostReply', 'loadPostReplies', 'renderReplies'];
            let allExists = functions.every(name => typeof window[name] === 'function');
            
            if (allExists) {
                log('âœ… å›å¤ç›¸å…³å‡½æ•°éƒ½å­˜åœ¨', 'success');
                document.getElementById('replyStatus').innerHTML = 'âœ… å›å¤æäº¤åŠŸèƒ½æ­£å¸¸';
                document.getElementById('replyStatus').className = 'status success';
                
                // æ¨¡æ‹Ÿåˆ›å»ºå›å¤è¡¨å•å…ƒç´ è¿›è¡Œæµ‹è¯•
                const testContent = 'è¿™æ˜¯ä¸€æ¡æµ‹è¯•å›å¤å†…å®¹ï¼';
                log(`æ¨¡æ‹Ÿå›å¤å†…å®¹: "${testContent}"`, 'info');
                
            } else {
                const missing = functions.filter(name => typeof window[name] !== 'function');
                log(`âŒ ç¼ºå°‘å‡½æ•°: ${missing.join(', ')}`, 'error');
                document.getElementById('replyStatus').innerHTML = 'âŒ å›å¤åŠŸèƒ½å¼‚å¸¸';
                document.getElementById('replyStatus').className = 'status error';
            }
        }
        
        function testReplyDisplay() {
            log('æµ‹è¯•å›å¤æ˜¾ç¤ºåŠŸèƒ½...', 'info');
            
            if (typeof loadPostReplies === 'function') {
                loadPostReplies('test-post-reply');
                log('âœ… å›å¤åŠ è½½å‡½æ•°è°ƒç”¨æˆåŠŸ', 'success');
            } else {
                log('âŒ loadPostReplies å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }
        
        function clearLog() { 
            document.getElementById('testLog').innerHTML = ''; 
            log('æ—¥å¿—å·²æ¸…ç©º', 'info'); 
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('å›å¤åŠŸèƒ½æµ‹è¯•é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'info');
            
            // æ£€æŸ¥æ ¸å¿ƒå‡½æ•°
            const coreFunctions = ['viewPostDetail', 'submitPostReply', 'loadPostReplies', 'renderReplies'];
            coreFunctions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`âœ“ ${funcName} å‡½æ•°å­˜åœ¨`, 'success');
                } else {
                    log(`âœ— ${funcName} å‡½æ•°ç¼ºå¤±`, 'error');
                }
            });
        });
    </script>
</body>
</html>