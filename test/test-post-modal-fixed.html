<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‘å¸ƒè¯é¢˜ä¿®å¤æµ‹è¯• - ç³å‡¯è’‚äºšè¯­</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="community.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 120px auto 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-align: center;
        }
        
        .test-button {
            display: inline-block;
            margin: 1rem;
            padding: 1rem 2rem;
            background: linear-gradient(45deg, #ffd700, #4ecdc4);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
            font-size: 1.1rem;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .instructions {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-left: 4px solid #ffd700;
        }
        
        .status-display {
            margin: 2rem 0;
            padding: 1rem;
            border-radius: 10px;
            font-family: monospace;
        }
        
        .status-success { background: rgba(76, 175, 80, 0.2); border: 1px solid #4caf50; }
        .status-error { background: rgba(244, 67, 54, 0.2); border: 1px solid #f44336; }
        .status-info { background: rgba(33, 150, 243, 0.2); border: 1px solid #2196f3; }
        
        .fix-notes {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(76, 175, 80, 0.1);
            border-radius: 10px;
            border-left: 4px solid #4caf50;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">ä¿®å¤æµ‹è¯•</span>
                    <span class="logo-english">Fixed Test</span>
                </div>
            </div>
            <div class="nav-extras">
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">ä¸ªäººä¸­å¿ƒ</a>
                        <a href="#" id="logoutLink">é€€å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="test-container">
        <h1>ğŸ”§ å‘å¸ƒè¯é¢˜åŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>
        
        <div class="fix-notes">
            <h3>ğŸ¯ ä¿®å¤å†…å®¹</h3>
            <ol>
                <li><strong>å‰å·å…³é—­æŒ‰é’®ä¿®å¤</strong>ï¼šå¢å¼ºäº†äº‹ä»¶ç»‘å®šï¼Œæ·»åŠ äº†é¢å¤–çš„onclickå¤„ç†</li>
                <li><strong>è¡¨å•éªŒè¯æ”¹è¿›</strong>ï¼šä½¿ç”¨é€šçŸ¥ç³»ç»Ÿæ›¿ä»£alertå¼¹çª—</li>
                <li><strong>å‘å¸ƒæˆåŠŸæç¤ºä¼˜åŒ–</strong>ï¼šä½¿ç”¨ç°ä»£åŒ–é€šçŸ¥æ›¿ä»£alert</li>
                <li><strong>é”™è¯¯å¤„ç†å®Œå–„</strong>ï¼šç»Ÿä¸€çš„é”™è¯¯æç¤ºæœºåˆ¶</li>
            </ol>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•æ­¥éª¤</h3>
            <ol style="text-align: left; max-width: 600px; margin: 0 auto;">
                <li>é¦–å…ˆç‚¹å‡»"ç™»å½•ç®¡ç†å‘˜"æŒ‰é’®è¿›è¡Œç™»å½•</li>
                <li>ç„¶åç‚¹å‡»"æµ‹è¯•å‘å¸ƒè¯é¢˜"æŒ‰é’®</li>
                <li>åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­ï¼š
                    <ul>
                        <li>âœ… æµ‹è¯•å³ä¸Šè§’çš„ âŒ æŒ‰é’®èƒ½å¦æ­£å¸¸å…³é—­</li>
                        <li>âœ… æµ‹è¯•ä¸å¡«å†™å†…å®¹ç›´æ¥ç‚¹å‡»"å‘å¸ƒè¯é¢˜"çš„éªŒè¯</li>
                        <li>âœ… å¡«å†™å®Œæ•´æ ‡é¢˜å’Œå†…å®¹ï¼Œæµ‹è¯•æ­£å¸¸å‘å¸ƒæµç¨‹</li>
                    </ul>
                </li>
            </ol>
        </div>
        
        <div class="status-display" id="statusDisplay">
            <strong>ç³»ç»ŸçŠ¶æ€:</strong> ç­‰å¾…æµ‹è¯•...
        </div>
        
        <button class="test-button" onclick="loginAdmin()">ğŸ” ç™»å½•ç®¡ç†å‘˜</button>
        <button class="test-button" onclick="testPostModal()">ğŸ“ æµ‹è¯•å‘å¸ƒè¯é¢˜</button>
        <button class="test-button" onclick="testValidation()">âš ï¸ æµ‹è¯•è¡¨å•éªŒè¯</button>
        <button class="test-button" onclick="checkStatus()">ğŸ” æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</button>
        <button class="test-button" onclick="logout()">ğŸšª é€€å‡ºç™»å½•</button>
        
        <div style="margin-top: 2rem;">
            <h3>ğŸ› é«˜çº§æµ‹è¯•</h3>
            <button class="test-button" onclick="testCloseButton()">ğŸ¯ ä¸“é¡¹æµ‹è¯•å…³é—­æŒ‰é’®</button>
            <button class="test-button" onclick="testEmptyForm()">ğŸ“‹ æµ‹è¯•ç©ºè¡¨å•æäº¤</button>
            <button class="test-button" onclick="testCompleteFlow()">ğŸ”„ æµ‹è¯•å®Œæ•´æµç¨‹</button>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>

    <script>
        // æ˜¾ç¤ºçŠ¶æ€
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('statusDisplay');
            statusDiv.className = `status-display status-${type}`;
            statusDiv.innerHTML = `<strong>çŠ¶æ€:</strong> ${message}`;
            console.log(`[çŠ¶æ€] ${message}`);
        }

        // é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            showStatus('é¡µé¢åŠ è½½å®Œæˆï¼Œæ­£åœ¨åˆå§‹åŒ–ä¿®å¤ç‰ˆæœ¬...', 'info');
            
            setTimeout(() => {
                checkStatus();
            }, 1000);
        });

        // ç™»å½•ç®¡ç†å‘˜
        async function loginAdmin() {
            showStatus('æ­£åœ¨ç™»å½•ç®¡ç†å‘˜è´¦æˆ·...', 'info');
            
            if (!window.authSystem) {
                showStatus('âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½', 'error');
                return;
            }
            
            try {
                const result = await window.authSystem.login({
                    username: 'admin',
                    password: 'admin123'
                });
                
                if (result.success) {
                    showStatus(`âœ… ç®¡ç†å‘˜ç™»å½•æˆåŠŸ: ${window.authSystem.currentUser.username}`, 'success');
                } else {
                    showStatus(`âŒ ç™»å½•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                showStatus(`âŒ ç™»å½•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†
        function testPostModal() {
            showStatus('æ­£åœ¨æµ‹è¯•ä¿®å¤åçš„å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†...', 'info');
            
            try {
                if (typeof showNewPostModal === 'function') {
                    showNewPostModal();
                    showStatus('âœ… å‘å¸ƒè¯é¢˜æ¨¡æ€æ¡†å·²æ‰“å¼€ï¼Œè¯·æµ‹è¯•å…³é—­æŒ‰é’®å’Œæäº¤åŠŸèƒ½', 'success');
                } else {
                    showStatus('âŒ showNewPostModal å‡½æ•°æœªå®šä¹‰', 'error');
                }
            } catch (error) {
                showStatus(`âŒ æ¨¡æ€æ¡†æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•è¡¨å•éªŒè¯
        function testValidation() {
            showStatus('æµ‹è¯•è¡¨å•éªŒè¯åŠŸèƒ½...', 'info');
            
            if (!window.authSystem?.currentUser) {
                showStatus('è¯·å…ˆç™»å½•å†æµ‹è¯•è¡¨å•éªŒè¯', 'error');
                return;
            }
            
            // æ‰“å¼€æ¨¡æ€æ¡†å¹¶å°è¯•æäº¤ç©ºè¡¨å•
            if (typeof showNewPostModal === 'function') {
                showNewPostModal();
                
                // ç­‰å¾…æ¨¡æ€æ¡†å®Œå…¨åŠ è½½åæµ‹è¯•
                setTimeout(() => {
                    const submitBtn = document.querySelector('.btn-submit');
                    if (submitBtn) {
                        showStatus('ç‚¹å‡»æäº¤æŒ‰é’®æµ‹è¯•éªŒè¯...', 'info');
                        submitBtn.click();
                    } else {
                        showStatus('âŒ æœªæ‰¾åˆ°æäº¤æŒ‰é’®', 'error');
                    }
                }, 500);
            }
        }

        // æ£€æŸ¥ç³»ç»ŸçŠ¶æ€
        function checkStatus() {
            let status = [];
            
            // æ£€æŸ¥è®¤è¯ç³»ç»Ÿ
            if (window.authSystem) {
                if (window.authSystem.currentUser) {
                    status.push(`âœ… ç”¨æˆ·å·²ç™»å½•: ${window.authSystem.currentUser.username}`);
                } else {
                    status.push(`âš ï¸ ç”¨æˆ·æœªç™»å½•`);
                }
            } else {
                status.push(`âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½`);
            }
            
            // æ£€æŸ¥ç¤¾åŒºç³»ç»Ÿ
            if (window.communitySystem) {
                status.push(`âœ… ç¤¾åŒºç³»ç»Ÿå·²åŠ è½½`);
            } else {
                status.push(`âŒ ç¤¾åŒºç³»ç»ŸæœªåŠ è½½`);
            }
            
            // æ£€æŸ¥å…³é”®å‡½æ•°
            const functions = ['showNewPostModal', 'closeNewPostModal', 'handleNewPostSubmit'];
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    status.push(`âœ… ${funcName} å‡½æ•°å¯ç”¨`);
                } else {
                    status.push(`âŒ ${funcName} å‡½æ•°ç¼ºå¤±`);
                }
            });
            
            showStatus(status.join('<br>'), status.some(s => s.includes('âŒ')) ? 'error' : 'success');
        }

        // é€€å‡ºç™»å½•
        function logout() {
            if (window.authSystem && window.authSystem.currentUser) {
                window.authSystem.logout();
                showStatus('âœ… å·²é€€å‡ºç™»å½•', 'info');
            } else {
                showStatus('âš ï¸ å½“å‰æœªç™»å½•', 'info');
            }
        }

        // ä¸“é¡¹æµ‹è¯•å…³é—­æŒ‰é’®
        function testCloseButton() {
            showStatus('ä¸“é¡¹æµ‹è¯•å…³é—­æŒ‰é’®åŠŸèƒ½...', 'info');
            
            if (!window.authSystem?.currentUser) {
                showStatus('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'error');
                return;
            }
            
            if (typeof showNewPostModal === 'function') {
                showNewPostModal();
                
                setTimeout(() => {
                    const closeBtn = document.querySelector('.close-modal-btn');
                    if (closeBtn) {
                        showStatus('æ‰¾åˆ°å…³é—­æŒ‰é’®ï¼Œè¯·ç‚¹å‡»æµ‹è¯•...', 'info');
                        // æ·»åŠ æµ‹è¯•æç¤º
                        closeBtn.style.border = '2px solid #ffd700';
                        closeBtn.style.animation = 'pulse 1s infinite';
                    } else {
                        showStatus('âŒ æœªæ‰¾åˆ°å…³é—­æŒ‰é’®', 'error');
                    }
                }, 300);
            }
        }

        // æµ‹è¯•ç©ºè¡¨å•æäº¤
        function testEmptyForm() {
            showStatus('æµ‹è¯•ç©ºè¡¨å•æäº¤éªŒè¯...', 'info');
            
            if (!window.authSystem?.currentUser) {
                showStatus('è¯·å…ˆç™»å½•å†æµ‹è¯•', 'error');
                return;
            }
            
            if (typeof showNewPostModal === 'function') {
                showNewPostModal();
                
                setTimeout(() => {
                    if (typeof handleNewPostSubmit === 'function') {
                        showStatus('ç›´æ¥è°ƒç”¨æäº¤å‡½æ•°æµ‹è¯•éªŒè¯...', 'info');
                        handleNewPostSubmit();
                    } else {
                        showStatus('âŒ handleNewPostSubmit å‡½æ•°æœªå®šä¹‰', 'error');
                    }
                }, 300);
            }
        }

        // æµ‹è¯•å®Œæ•´æµç¨‹
        function testCompleteFlow() {
            showStatus('å¼€å§‹æµ‹è¯•å®Œæ•´å‘å¸ƒæµç¨‹...', 'info');
            
            if (!window.authSystem?.currentUser) {
                showStatus('è¯·å…ˆç™»å½•å†æµ‹è¯•å®Œæ•´æµç¨‹', 'error');
                return;
            }
            
            if (typeof showNewPostModal === 'function') {
                showNewPostModal();
                
                setTimeout(() => {
                    // è‡ªåŠ¨å¡«å†™è¡¨å•
                    const titleInput = document.getElementById('newPostTitle');
                    const contentTextarea = document.getElementById('newPostContent');
                    
                    if (titleInput && contentTextarea) {
                        titleInput.value = 'æµ‹è¯•æ ‡é¢˜ - è‡ªåŠ¨å¡«å†™';
                        contentTextarea.value = 'è¿™æ˜¯ä¸€ä¸ªè‡ªåŠ¨æµ‹è¯•å†…å®¹ï¼Œç”¨äºéªŒè¯å‘å¸ƒåŠŸèƒ½æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚';
                        
                        showStatus('å·²è‡ªåŠ¨å¡«å†™è¡¨å•ï¼Œç‚¹å‡»å‘å¸ƒæŒ‰é’®æµ‹è¯•...', 'success');
                        
                        // é«˜äº®æäº¤æŒ‰é’®
                        const submitBtn = document.querySelector('.btn-submit');
                        if (submitBtn) {
                            submitBtn.style.border = '2px solid #ffd700';
                            submitBtn.style.animation = 'pulse 1s infinite';
                        }
                    } else {
                        showStatus('âŒ æœªæ‰¾åˆ°è¡¨å•å…ƒç´ ', 'error');
                    }
                }, 300);
            }
        }
    </script>

    <style>
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
    </style>
</body>
</html>