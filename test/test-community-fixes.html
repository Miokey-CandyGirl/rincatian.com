<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾åŒºåŠŸèƒ½ä¿®å¤æµ‹è¯• - ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a237e; color: white; }
        .test-section { background: rgba(255,255,255,0.1); padding: 20px; margin: 20px 0; border-radius: 10px; border: 1px solid rgba(255,215,0,0.3); }
        .test-button { background: #4CAF50; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        .test-button:hover { background: #45a049; }
        .filter-btn { padding: 8px 16px; border: 1px solid rgba(255,215,0,0.3); background: rgba(255,215,0,0.1); color: #ffd700; border-radius: 20px; cursor: pointer; margin: 5px; }
        .filter-btn.active { background: linear-gradient(45deg, #ffd700, #4ecdc4); color: #1a1a2e; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .success { background: rgba(76,175,80,0.2); color: #4caf50; }
        .error { background: rgba(244,67,54,0.2); color: #f44336; }
        .info { background: rgba(33,150,243,0.2); color: #2196f3; }
        .test-log { background: #000; color: #00ff00; padding: 15px; border-radius: 5px; font-family: monospace; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>
    <h1>ğŸ”§ ç¤¾åŒºåŠŸèƒ½ä¿®å¤æµ‹è¯•</h1>
    
    <div class="test-section">
        <h2>ğŸ“ æµ‹è¯•æ•°æ®å‡†å¤‡</h2>
        <button class="test-button" onclick="createTestData()">åˆ›å»ºæµ‹è¯•æ•°æ®</button>
        <button class="test-button" onclick="loginTestUser()">ç™»å½•æµ‹è¯•ç”¨æˆ·</button>
        <div id="dataStatus" class="status info">ç­‰å¾…åˆ›å»ºæµ‹è¯•æ•°æ®...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ” ç­›é€‰åŠŸèƒ½æµ‹è¯•</h2>
        <div class="posts-container">
            <div style="display: flex; gap: 10px; margin: 20px 0;">
                <button class="filter-btn active" data-filter="all">å…¨éƒ¨</button>
                <button class="filter-btn" data-filter="hot">çƒ­é—¨</button>
                <button class="filter-btn" data-filter="latest">æœ€æ–°</button>
                <button class="filter-btn" data-filter="unanswered">å¾…å›å¤</button>
            </div>
            <div id="testPostsList" style="margin: 20px 0;">
                <!-- å¸–å­åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </div>
        <button class="test-button" onclick="testAllFilters()">è‡ªåŠ¨æµ‹è¯•æ‰€æœ‰ç­›é€‰</button>
        <div id="filterStatus" class="status info">ç‚¹å‡»ç­›é€‰æŒ‰é’®æµ‹è¯•</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ—‘ï¸ åˆ é™¤åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testDeleteOwnPost()">æµ‹è¯•åˆ é™¤è‡ªå·±çš„å¸–å­</button>
        <button class="test-button" onclick="testDeleteOthersPost()">æµ‹è¯•åˆ é™¤åˆ«äººçš„å¸–å­</button>
        <div id="deleteStatus" class="status info">ç­‰å¾…æµ‹è¯•åˆ é™¤åŠŸèƒ½...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ’¬ å›å¤åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testReplyFunction()">æµ‹è¯•å›å¤åŠŸèƒ½</button>
        <button class="test-button" onclick="testPostDetailView()">æµ‹è¯•å¸–å­è¯¦æƒ…æŸ¥çœ‹</button>
        <div id="replyStatus" class="status info">ç­‰å¾…æµ‹è¯•å›å¤åŠŸèƒ½...</div>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æµ‹è¯•æ—¥å¿—</h2>
        <div class="test-log" id="testLog">[ç³»ç»Ÿ] æµ‹è¯•é¡µé¢å·²åŠ è½½...<br></div>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
    </div>

    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>
    
    <script>
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const colors = { 'success': '#00ff00', 'error': '#ff0000', 'warning': '#ffaa00', 'info': '#00ffff' };
            const color = colors[type] || '#ffffff';
            const logElement = document.getElementById('testLog');
            logElement.innerHTML += `<span style="color: ${color}">[${timestamp}] ${message}</span><br>`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function createTestData() {
            log('åˆ›å»ºæµ‹è¯•æ•°æ®...', 'info');
            const testPosts = [
                {
                    id: 'test-post-1', title: 'ğŸŒŸ æˆ‘çš„æµ‹è¯•å¸–å­', content: 'è¿™æ˜¯æˆ‘çš„å¸–å­ï¼Œæˆ‘å¯ä»¥åˆ é™¤å®ƒã€‚',
                    author: { id: 'test-user', username: 'testuser', avatar: 'ğŸ§ª' },
                    timestamp: Date.now() - 60000, likes: [], replyCount: 0, views: 15
                },
                {
                    id: 'test-post-2', title: 'ğŸ“š åˆ«äººçš„å¸–å­', content: 'è¿™æ˜¯å…¶ä»–ç”¨æˆ·çš„å¸–å­ï¼Œçƒ­é—¨å†…å®¹ã€‚',
                    author: { id: 'other-user', username: 'otheruser', avatar: 'ğŸ‘¤' },
                    timestamp: Date.now() - 300000, likes: ['u1','u2','u3','u4','u5'], replyCount: 3, views: 45
                },
                {
                    id: 'test-post-3', title: 'â“ å¾…å›å¤å¸–å­', content: 'è¿™æ˜¯ä¸€ä¸ªæ²¡æœ‰å›å¤çš„å¸–å­ã€‚',
                    author: { id: 'another-user', username: 'anotheruser', avatar: 'ğŸ¤”' },
                    timestamp: Date.now() - 120000, likes: [], replyCount: 0, views: 8
                }
            ];
            
            localStorage.setItem('communityPosts', JSON.stringify(testPosts));
            if (typeof communityData !== 'undefined') { communityData.posts = testPosts; }
            log('âœ… æµ‹è¯•æ•°æ®åˆ›å»ºæˆåŠŸ', 'success');
            loadTestPosts('all');
            document.getElementById('dataStatus').innerHTML = 'âœ… æµ‹è¯•æ•°æ®å·²åˆ›å»º';
            document.getElementById('dataStatus').className = 'status success';
        }
        
        function loginTestUser() {
            const testUser = { id: 'test-user', username: 'testuser', avatar: 'ğŸ§ª' };
            localStorage.setItem('currentUser', JSON.stringify(testUser));
            if (typeof communityData !== 'undefined') { communityData.currentUser = testUser; }
            log('âœ… æµ‹è¯•ç”¨æˆ·ç™»å½•æˆåŠŸ', 'success');
        }
        
        function loadTestPosts(filterType) {
            const postsList = document.getElementById('testPostsList');
            let posts = JSON.parse(localStorage.getItem('communityPosts') || '[]');
            
            // ç­›é€‰é€»è¾‘
            switch (filterType) {
                case 'hot':
                    posts.sort((a,b) => (b.likes.length + b.replyCount*2) - (a.likes.length + a.replyCount*2));
                    break;
                case 'unanswered':
                    posts = posts.filter(p => p.replyCount === 0);
                    break;
                default:
                    posts.sort((a,b) => b.timestamp - a.timestamp);
            }
            
            if (posts.length === 0) {
                postsList.innerHTML = '<p>æš‚æ— å¸–å­ï¼Œè¯·å…ˆåˆ›å»ºæµ‹è¯•æ•°æ®</p>';
                return;
            }
            
            postsList.innerHTML = posts.map(post => {
                const currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
                const isAuthor = currentUser && currentUser.id === post.author.id;
                return `
                    <div style="background: rgba(255,255,255,0.05); border-radius: 10px; padding: 15px; margin: 10px 0;">
                        <h4 style="color: #ffd700;">${post.title}</h4>
                        <p style="color: #e0e0e0;">${post.content}</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button onclick="testViewPost('${post.id}')" style="background: rgba(78,205,196,0.2); color: #4ecdc4; border: 1px solid rgba(78,205,196,0.3); padding: 5px 10px; border-radius: 15px; cursor: pointer;">ğŸ‘ï¸ æŸ¥çœ‹</button>
                            <button onclick="testReplyPost('${post.id}')" style="background: rgba(255,215,0,0.2); color: #ffd700; border: 1px solid rgba(255,215,0,0.3); padding: 5px 10px; border-radius: 15px; cursor: pointer;">ğŸ’¬ å›å¤</button>
                            ${isAuthor ? `<button onclick="testDeletePost('${post.id}')" style="background: rgba(244,67,54,0.2); color: #f44336; border: 1px solid rgba(244,67,54,0.3); padding: 5px 10px; border-radius: 15px; cursor: pointer;">ğŸ—‘ï¸ åˆ é™¤</button>` : ''}
                        </div>
                    </div>
                `;
            }).join('');
            
            log(`âœ… æ˜¾ç¤º ${posts.length} ä¸ªå¸–å­ (${filterType})`, 'success');
        }
        
        function testAllFilters() {
            const filters = ['all', 'hot', 'latest', 'unanswered'];
            let i = 0;
            function next() {
                if (i >= filters.length) { 
                    log('âœ… æ‰€æœ‰ç­›é€‰æµ‹è¯•å®Œæˆ', 'success'); 
                    document.getElementById('filterStatus').innerHTML = 'âœ… ç­›é€‰åŠŸèƒ½æ­£å¸¸';
                    document.getElementById('filterStatus').className = 'status success';
                    return; 
                }
                const filter = filters[i];
                document.querySelectorAll('.filter-btn').forEach(btn => {
                    btn.classList.toggle('active', btn.dataset.filter === filter);
                });
                loadTestPosts(filter);
                log(`æµ‹è¯•ç­›é€‰: ${filter}`, 'info');
                i++;
                setTimeout(next, 1000);
            }
            next();
        }
        
        function testDeleteOwnPost() {
            if (typeof deleteMyPost === 'function') {
                deleteMyPost('test-post-1');
                setTimeout(() => { loadTestPosts('all'); }, 500);
                log('âœ… åˆ é™¤è‡ªå·±å¸–å­æµ‹è¯•å®Œæˆ', 'success');
                document.getElementById('deleteStatus').innerHTML = 'âœ… åˆ é™¤åŠŸèƒ½æ­£å¸¸';
                document.getElementById('deleteStatus').className = 'status success';
            } else {
                log('âŒ deleteMyPost å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }
        
        function testDeleteOthersPost() {
            if (typeof deleteMyPost === 'function') {
                deleteMyPost('test-post-2');
                log('âœ… æƒé™ä¿æŠ¤æµ‹è¯•å®Œæˆ', 'success');
            } else {
                log('âŒ deleteMyPost å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }
        
        function testReplyFunction() {
            const functions = ['replyToPost', 'viewPostDetail'];
            let allExists = functions.every(name => typeof window[name] === 'function');
            if (allExists) {
                log('âœ… å›å¤ç›¸å…³å‡½æ•°å­˜åœ¨', 'success');
                document.getElementById('replyStatus').innerHTML = 'âœ… å›å¤åŠŸèƒ½æ­£å¸¸';
                document.getElementById('replyStatus').className = 'status success';
            } else {
                log('âŒ éƒ¨åˆ†å›å¤åŠŸèƒ½ç¼ºå¤±', 'error');
                document.getElementById('replyStatus').innerHTML = 'âŒ å›å¤åŠŸèƒ½å¼‚å¸¸';
                document.getElementById('replyStatus').className = 'status error';
            }
        }
        
        function testPostDetailView() {
            if (typeof viewPostDetail === 'function') {
                viewPostDetail('test-post-1');
                log('âœ… å¸–å­è¯¦æƒ…æŸ¥çœ‹è°ƒç”¨æˆåŠŸ', 'success');
            } else {
                log('âŒ viewPostDetail å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }
        
        function testViewPost(id) { if (typeof viewPostDetail === 'function') viewPostDetail(id); }
        function testReplyPost(id) { if (typeof replyToPost === 'function') replyToPost(id); }
        function testDeletePost(id) { if (typeof deleteMyPost === 'function') { deleteMyPost(id); setTimeout(() => loadTestPosts('all'), 500); } }
        function clearLog() { document.getElementById('testLog').innerHTML = ''; log('æ—¥å¿—å·²æ¸…ç©º', 'info'); }
        
        // ç»‘å®šç­›é€‰æŒ‰é’®äº‹ä»¶
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    loadTestPosts(this.dataset.filter);
                    log('ç‚¹å‡»ç­›é€‰: ' + this.dataset.filter, 'info');
                });
            });
            log('é¡µé¢åˆå§‹åŒ–å®Œæˆ', 'info');
        });
    </script>
</body>
</html>