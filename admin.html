<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理员后台 - 琳凯蒂亚语社区</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="stars"></div>
    <div class="floating-particles"></div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">琳凯蒂亚语社区</span>
                    <span class="logo-english">Rincatian Community</span>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">首页</a></li>
                <li><a href="grammar.html">语法</a></li>
                <li><a href="culture.html">文化</a></li>
                <li><a href="dictionary.html">词典</a></li>
                <li><a href="community.html">社区</a></li>
                <li><a href="admin.html" class="active">管理</a></li>
            </ul>
            <div class="nav-extras">
                <div class="tian-calendar">
                    <span class="calendar-icon">📅</span>
                    <span class="tian-date" id="tianDate">载入中...</span>
                </div>
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">登录</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">注册</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="user-profile.html" id="profileLink">个人中心</a>
                        <a href="#" id="logoutLink">退出</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="admin-main">
        <div class="admin-container">
            <!-- 权限检查提示 -->
            <div id="accessDenied" class="access-denied" style="display: none;">
                <div class="access-denied-content">
                    <h2>🔒 访问受限</h2>
                    <p>此页面仅限管理员访问，请先登录管理员账户。</p>
                    <p><strong>默认管理员账户：</strong></p>
                    <p>用户名: 琳凯蒂亚</p>
                    <p>密码: Rincatian-2015!</p>
                    <button class="btn btn-primary" onclick="showLoginModal()">立即登录</button>
                </div>
            </div>

            <!-- 管理员面板 -->
            <div id="adminPanel" class="admin-panel" style="display: none;">
                <header class="admin-header">
                    <h1>🌟 琳凯蒂亚语社区管理中心 🌟</h1>
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalWords">0</div>
                            <div class="stat-label">词汇总数</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalGrammar">0</div>
                            <div class="stat-label">语法规则</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalPhrases">0</div>
                            <div class="stat-label">常用短语</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalUsers">0</div>
                            <div class="stat-label">注册用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="onlineUsers">0</div>
                            <div class="stat-label">在线用户</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalVisits">0</div>
                            <div class="stat-label">总访问量</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="todayVisits">0</div>
                            <div class="stat-label">今日访问</div>
                        </div>
                    </div>
                </header>

                <nav class="admin-nav">
                    <ul class="admin-tabs">
                        <li><a class="admin-tab active" data-tab="users">用户管理</a></li>
                        <li><a class="admin-tab" data-tab="analytics">数据统计</a></li>
                        <li><a class="admin-tab" data-tab="vocabulary">词汇管理</a></li>
                        <li><a class="admin-tab" data-tab="grammar">语法管理</a></li>
                        <li><a class="admin-tab" data-tab="phrases">短语管理</a></li>
                        <li><a class="admin-tab" data-tab="settings">系统设置</a></li>
                    </ul>
                </nav>

                <div class="admin-content">
                    <!-- 用户管理 -->
                    <section id="users" class="admin-section active">
                        <div class="section-header">
                            <h2>用户管理</h2>
                            <button class="btn btn-primary" id="addUserBtn">
                                <span class="icon">➕</span>
                                添加新用户
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="userSearch" placeholder="搜索用户..." class="search-input">
                            <select id="userRoleFilter" class="filter-select">
                                <option value="">全部角色</option>
                                <option value="管理员">管理员</option>
                                <option value="版主">版主</option>
                                <option value="用户">普通用户</option>
                            </select>
                            <select id="userStatusFilter" class="filter-select">
                                <option value="">全部状态</option>
                                <option value="active">活跃</option>
                                <option value="inactive">非活跃</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="usersTable">
                                <thead>
                                    <tr>
                                        <th>用户信息</th>
                                        <th>邮箱</th>
                                        <th>角色</th>
                                        <th>等级</th>
                                        <th>状态</th>
                                        <th>注册时间</th>
                                        <th>最后登录</th>
                                        <th>活动数据</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- 数据统计 -->
                    <section id="analytics" class="admin-section">
                        <div class="section-header">
                            <h2>📊 数据统计与分析</h2>
                            <button class="btn btn-primary" id="refreshStatsBtn">
                                <span class="icon">🔄</span>
                                刷新数据
                            </button>
                        </div>
                        
                        <div class="content-table">
                            <table>
                                <thead>
                                    <tr>
                                        <th>统计项目</th>
                                        <th>数值</th>
                                        <th>说明</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>总注册用户数</td>
                                        <td id="analyticsTotalUsers">0</td>
                                        <td>平台所有注册用户数量</td>
                                    </tr>
                                    <tr>
                                        <td>活跃用户数</td>
                                        <td id="analyticsActiveUsers">0</td>
                                        <td>最近30天有活动的用户</td>
                                    </tr>
                                    <tr>
                                        <td>总访问量</td>
                                        <td id="analyticsTotalVisits">0</td>
                                        <td>平台总访问次数</td>
                                    </tr>
                                    <tr>
                                        <td>今日访问量</td>
                                        <td id="analyticsTodayVisits">0</td>
                                        <td>今日访问次数</td>
                                    </tr>
                                    <tr>
                                        <td>总发帖数</td>
                                        <td id="analyticsTotalPosts">0</td>
                                        <td>社区总发帖数量</td>
                                    </tr>
                                    <tr>
                                        <td>总回复数</td>
                                        <td id="analyticsTotalReplies">0</td>
                                        <td>社区总回复数量</td>
                                    </tr>
                                    <tr>
                                        <td>词汇总数</td>
                                        <td id="analyticsTotalVocabulary">0</td>
                                        <td>词典中词汇数量</td>
                                    </tr>
                                    <tr>
                                        <td>语法规则数</td>
                                        <td id="analyticsTotalGrammarRules">0</td>
                                        <td>语法模块规则数量</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- 词汇管理 -->
                    <section id="vocabulary" class="admin-section">
                        <div class="section-header">
                            <h2>词汇管理</h2>
                            <button class="btn btn-primary" id="addVocabBtn">
                                <span class="icon">➕</span>
                                添加新词汇
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="vocabSearch" placeholder="搜索词汇..." class="search-input">
                            <select id="vocabTypeFilter" class="filter-select">
                                <option value="">全部词性</option>
                                <option value="名">名词</option>
                                <option value="动">动词</option>
                                <option value="形">形容词</option>
                                <option value="副">副词</option>
                                <option value="代">代词</option>
                                <option value="数">数词</option>
                                <option value="连">连词</option>
                                <option value="助">助词</option>
                                <option value="抒">抒情词</option>
                                <option value="声">声叹词</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="vocabularyTable">
                                <thead>
                                    <tr>
                                        <th>琳凯蒂亚语</th>
                                        <th>发音</th>
                                        <th>中文含义</th>
                                        <th>词性</th>
                                        <th>等级</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="vocabularyTableBody">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- 语法管理 -->
                    <section id="grammar" class="admin-section">
                        <div class="section-header">
                            <h2>语法管理</h2>
                            <button class="btn btn-primary" id="addGrammarBtn">
                                <span class="icon">➕</span>
                                添加语法规则
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="grammarSearch" placeholder="搜索语法规则..." class="search-input">
                            <select id="grammarCategoryFilter" class="filter-select">
                                <option value="">全部分类</option>
                                <option value="基础语法">基础语法</option>
                                <option value="词法">词法</option>
                                <option value="句法">句法</option>
                                <option value="语音">语音</option>
                                <option value="语义">语义</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="grammarTable">
                                <thead>
                                    <tr>
                                        <th>标题</th>
                                        <th>分类</th>
                                        <th>等级</th>
                                        <th>创建时间</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="grammarTableBody">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- 短语管理 -->
                    <section id="phrases" class="admin-section">
                        <div class="section-header">
                            <h2>短语管理</h2>
                            <button class="btn btn-primary" id="addPhraseBtn">
                                <span class="icon">➕</span>
                                添加新短语
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="phraseSearch" placeholder="搜索短语..." class="search-input">
                            <select id="phraseCategoryFilter" class="filter-select">
                                <option value="">全部分类</option>
                                <option value="greeting">问候用语</option>
                                <option value="basic">基础对话</option>
                                <option value="time">时间表达</option>
                                <option value="magic">魔法用语</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="phrasesTable">
                                <thead>
                                    <tr>
                                        <th>琳凯蒂亚语</th>
                                        <th>中文</th>
                                        <th>发音</th>
                                        <th>分类</th>
                                        <th>等级</th>
                                        <th>操作</th>
                                    </tr>
                                </thead>
                                <tbody id="phrasesTableBody">
                                    <!-- 动态生成 -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- 系统设置 -->
                    <section id="settings" class="admin-section">
                        <div class="section-header">
                            <h2>系统设置</h2>
                        </div>
                        
                        <div class="settings-grid">
                            <div class="settings-card">
                                <h3>数据管理</h3>
                                <div class="settings-actions">
                                    <button class="btn btn-primary" id="exportDataBtn">导出数据</button>
                                    <button class="btn btn-primary" id="importDataBtn">导入数据</button>
                                    <button class="btn btn-primary" id="clearDataBtn">清空数据</button>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <h3>管理员账户</h3>
                                <div class="settings-actions">
                                    <button class="btn btn-primary" id="changeAdminPasswordBtn">修改管理员密码</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- 用户详情模态框 -->
    <div class="modal" id="userDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>用户详情</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body" id="userDetailContent">
                <!-- 动态生成 -->
            </div>
        </div>
    </div>

    <!-- 添加用户模态框 -->
    <div class="modal" id="addUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>添加新用户</h3>
                <button class="close-btn">&times;</button>
            </div>
            <div class="modal-body">
                <form id="addUserForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newUsername">用户名</label>
                            <input type="text" id="newUsername" required>
                        </div>
                        <div class="form-group">
                            <label for="newEmail">邮箱</label>
                            <input type="email" id="newEmail" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newPassword">密码</label>
                            <input type="password" id="newPassword" required>
                        </div>
                        <div class="form-group">
                            <label for="newRole">角色</label>
                            <select id="newRole" required>
                                <option value="user">普通用户</option>
                                <option value="moderator">版主</option>
                                <option value="admin">管理员</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="newStatus">状态</label>
                            <select id="newStatus" required>
                                <option value="active">活跃</option>
                                <option value="inactive">非活跃</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary">创建用户</button>
                </form>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>琳凯蒂亚语社区</h3>
                <p>探索奇幻语言的魅力</p>
                <p>基于《光线传奇》小说世界</p>
            </div>
            <div class="footer-section">
                <h4>快速链接</h4>
                <ul>
                    <li><a href="index.html">首页</a></li>
                    <li><a href="grammar.html">语法</a></li>
                    <li><a href="culture.html">文化</a></li>
                    <li><a href="dictionary.html">词典</a></li>
                    <li><a href="community.html">社区</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>联系我们</h4>
                <p>📧 邮箱：1778181360@qq.com</p>
                <p>👥 QQ群：1234567890</p>
                <div class="institution">
                    <h5>华田中央大学田语学院</h5>
                    <p>专业的琳凯蒂亚语研究与教学机构</p>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 琳凯蒂亚语社区. 版权所有.</p>
            <p>华田中央大学田语学院 版权所有</p>
        </div>
    </footer>

    <script src="auth-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="admin.js"></script>
    
    <script>
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🔧 管理员页面加载完成');
            
            // 确保认证系统已加载
            if (typeof window.authSystem === 'undefined') {
                console.log('⏳ 等待认证系统加载...');
                // 延迟检查
                setTimeout(checkAdminAccess, 1000);
            } else {
                // 检查用户权限
                checkAdminAccess();
            }
        });
        
        // 检查管理员权限
        function checkAdminAccess() {
            console.log('🔐 检查管理员权限...');
            
            const accessDenied = document.getElementById('accessDenied');
            const adminPanel = document.getElementById('adminPanel');
            
            // 检查当前用户
            const currentUser = window.authSystem ? window.authSystem.currentUser : null;
            
            console.log('👤 当前用户:', currentUser);
            
            if (currentUser && (currentUser.role === 'admin' || currentUser.role === '管理员' || 
                               currentUser.username === '琳凯蒂亚' || currentUser.username === 'admin')) {
                console.log('✅ 管理员权限验证通过');
                
                // 显示管理面板
                if (accessDenied) accessDenied.style.display = 'none';
                if (adminPanel) {
                    adminPanel.style.display = 'block';
                    console.log('✅ 管理面板已显示');
                }
                
                // 初始化管理面板数据
                if (window.adminPanel) {
                    try {
                        window.adminPanel.init();
                    } catch (error) {
                        console.error('❌ 管理面板初始化失败:', error);
                        // 创建新的实例
                        window.adminPanel = new AdminPanel();
                        window.adminPanel.init();
                    }
                } else {
                    // 如果adminPanel尚未创建，则创建它
                    window.adminPanel = new AdminPanel();
                    window.adminPanel.init();
                }
            } else {
                console.log('❌ 权限不足，显示拒绝访问页面');
                
                // 显示拒绝访问页面
                if (accessDenied) accessDenied.style.display = 'block';
                if (adminPanel) adminPanel.style.display = 'none';
            }
        }
        
        // 显示登录模态框
        function showLoginModal() {
            // 这里应该调用现有的登录功能
            if (document.getElementById('loginBtn')) {
                document.getElementById('loginBtn').click();
            }
        }
    </script>
</body>
</html>