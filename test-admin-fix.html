<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜é¡µé¢ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: linear-gradient(135deg, #1a237e, #3f51b5);
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        h1 {
            color: #ffd700;
            text-align: center;
            margin-bottom: 30px;
        }
        .test-section {
            background: rgba(0, 0, 0, 0.3);
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            border: 1px solid rgba(255, 215, 0, 0.3);
        }
        .test-section h2 {
            color: #00bcd4;
            margin-top: 0;
        }
        button {
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px 5px;
            transition: all 0.3s ease;
        }
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        .result {
            background: rgba(0, 0, 0, 0.2);
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            white-space: pre-wrap;
            font-family: monospace;
            max-height: 300px;
            overflow-y: auto;
        }
        .success {
            border-left: 4px solid #4caf50;
        }
        .error {
            border-left: 4px solid #f44336;
        }
        .info {
            border-left: 4px solid #2196f3;
        }
        a {
            color: #00bcd4;
            text-decoration: none;
        }
        a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒŸ ç®¡ç†å‘˜é¡µé¢ä¿®å¤æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>ğŸ”§ æµ‹è¯•è¯´æ˜</h2>
            <p>æœ¬é¡µé¢ç”¨äºæµ‹è¯•ç®¡ç†å‘˜é¡µé¢çš„ä¿®å¤æ•ˆæœï¼ŒåŒ…æ‹¬ï¼š</p>
            <ul>
                <li>æŒ‰é’®ç‚¹å‡»åŠŸèƒ½æ˜¯å¦æ­£å¸¸</li>
                <li>ç”¨æˆ·æ•°æ®æ˜¯å¦èƒ½æ­£ç¡®è·å–</li>
                <li>ç»Ÿè®¡æ•°æ®æ˜¯å¦æ˜¾ç¤ºçœŸå®æ•°æ®</li>
            </ul>
            <p>è¯·å…ˆç¡®ä¿æ‚¨å·²ä½¿ç”¨é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ï¼š</p>
            <p><strong>ç”¨æˆ·åï¼š</strong>ç³å‡¯è’‚äºš</p>
            <p><strong>å¯†ç ï¼š</strong>Rincatian-2015!</p>
        </div>
        
        <div class="test-section">
            <h2>ğŸ§ª åŠŸèƒ½æµ‹è¯•</h2>
            <button onclick="testAuthSystem()">æµ‹è¯•è®¤è¯ç³»ç»Ÿ</button>
            <button onclick="testUserData()">æµ‹è¯•ç”¨æˆ·æ•°æ®</button>
            <button onclick="testAdminPanel()">æµ‹è¯•ç®¡ç†é¢æ¿</button>
            <button onclick="showLocalStorage()">æŸ¥çœ‹æœ¬åœ°å­˜å‚¨</button>
            
            <div id="testResult" class="result info">
                ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®å¼€å§‹æµ‹è¯•...
            </div>
        </div>
        
        <div class="test-section">
            <h2>ğŸ”— å¿«é€Ÿé“¾æ¥</h2>
            <p><a href="admin.html" target="_blank">â¡ï¸ è®¿é—®ç®¡ç†å‘˜é¡µé¢</a></p>
            <p><a href="localstorage-viewer.html" target="_blank">â¡ï¸ æŸ¥çœ‹æœ¬åœ°å­˜å‚¨æ•°æ®</a></p>
            <p><a href="admin-test.html" target="_blank">â¡ï¸ ç®¡ç†å‘˜åŠŸèƒ½è¯¦ç»†æµ‹è¯•</a></p>
        </div>
    </div>

    <script src="auth-system.js"></script>
    <script src="user-database.js"></script>
    <script src="admin.js"></script>
    
    <script>
        function updateResult(content, type = 'info') {
            const resultDiv = document.getElementById('testResult');
            resultDiv.textContent = content;
            resultDiv.className = 'result ' + type;
        }
        
        function testAuthSystem() {
            updateResult('æ­£åœ¨æµ‹è¯•è®¤è¯ç³»ç»Ÿ...', 'info');
            
            setTimeout(() => {
                try {
                    if (typeof window.authSystem !== 'undefined') {
                        const users = window.authSystem.users;
                        const currentUser = window.authSystem.currentUser;
                        const isAdmin = window.authSystem.isAdmin();
                        
                        let result = `âœ… è®¤è¯ç³»ç»Ÿæµ‹è¯•é€šè¿‡\n\n`;
                        result += `æ€»ç”¨æˆ·æ•°: ${users.length}\n`;
                        result += `å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.username : 'æœªç™»å½•'}\n`;
                        result += `æ˜¯å¦ä¸ºç®¡ç†å‘˜: ${isAdmin}\n\n`;
                        result += `ç”¨æˆ·åˆ—è¡¨:\n`;
                        users.forEach((user, index) => {
                            result += `  ${index + 1}. ${user.username} (${user.role})\n`;
                        });
                        
                        updateResult(result, 'success');
                    } else {
                        updateResult('âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½', 'error');
                    }
                } catch (error) {
                    updateResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }, 500);
        }
        
        function testUserData() {
            updateResult('æ­£åœ¨æµ‹è¯•ç”¨æˆ·æ•°æ®è·å–...', 'info');
            
            setTimeout(() => {
                try {
                    if (typeof window.adminPanel !== 'undefined') {
                        const users = window.adminPanel.getUsersData();
                        
                        let result = `âœ… ç”¨æˆ·æ•°æ®è·å–æµ‹è¯•é€šè¿‡\n\n`;
                        result += `è·å–åˆ°ç”¨æˆ·æ•°: ${users.length}\n\n`;
                        result += `ç”¨æˆ·è¯¦æƒ…:\n`;
                        users.forEach((user, index) => {
                            result += `  ${index + 1}. ${user.username}\n`;
                            result += `     ID: ${user.id}\n`;
                            result += `     è§’è‰²: ${user.role}\n`;
                            result += `     é‚®ç®±: ${user.email || 'æœªè®¾ç½®'}\n`;
                            result += `     æ³¨å†Œæ—¶é—´: ${user.joinDate ? new Date(user.joinDate).toLocaleDateString() : 'æœªçŸ¥'}\n`;
                            result += `     æœ€åç™»å½•: ${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'ä»æœª'}\n\n`;
                        });
                        
                        updateResult(result, 'success');
                    } else {
                        updateResult('âŒ ç®¡ç†é¢æ¿æœªåŠ è½½', 'error');
                    }
                } catch (error) {
                    updateResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }, 500);
        }
        
        function testAdminPanel() {
            updateResult('æ­£åœ¨æµ‹è¯•ç®¡ç†é¢æ¿...', 'info');
            
            setTimeout(() => {
                try {
                    if (typeof window.adminPanel !== 'undefined') {
                        // æµ‹è¯•æƒé™æ£€æŸ¥
                        const hasAccess = window.adminPanel.checkAdminAccess();
                        
                        // æµ‹è¯•è·å–å½“å‰ç”¨æˆ·
                        const currentUser = window.adminPanel.getCurrentUser();
                        
                        let result = `âœ… ç®¡ç†é¢æ¿æµ‹è¯•é€šè¿‡\n\n`;
                        result += `ç®¡ç†å‘˜æƒé™: ${hasAccess}\n`;
                        result += `å½“å‰ç”¨æˆ·: ${currentUser ? currentUser.username : 'æœªè·å–åˆ°'}\n\n`;
                        
                        if (hasAccess) {
                            result += `ğŸ‰ ç®¡ç†å‘˜æƒé™éªŒè¯æˆåŠŸï¼\n`;
                            result += `æ‚¨å¯ä»¥æ­£å¸¸è®¿é—®ç®¡ç†å‘˜é¡µé¢çš„æ‰€æœ‰åŠŸèƒ½ã€‚\n\n`;
                            result += `å»ºè®®æ“ä½œ:\n`;
                            result += `1. è®¿é—®ç®¡ç†å‘˜é¡µé¢æµ‹è¯•æŒ‰é’®åŠŸèƒ½\n`;
                            result += `2. æ£€æŸ¥ç”¨æˆ·åˆ—è¡¨æ˜¯å¦æ˜¾ç¤ºæ­£ç¡®\n`;
                            result += `3. éªŒè¯ç»Ÿè®¡æ•°æ®æ˜¯å¦æ˜¾ç¤ºçœŸå®æ•°æ®`;
                        } else {
                            result += `âš ï¸ æƒé™éªŒè¯å¤±è´¥\n`;
                            result += `è¯·ç¡®ä¿æ‚¨å·²ä½¿ç”¨ç®¡ç†å‘˜è´¦æˆ·ç™»å½•ã€‚\n`;
                            result += `é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·:\n`;
                            result += `ç”¨æˆ·å: ç³å‡¯è’‚äºš\n`;
                            result += `å¯†ç : Rincatian-2015!`;
                        }
                        
                        updateResult(result, 'success');
                    } else {
                        updateResult('âŒ ç®¡ç†é¢æ¿æœªåŠ è½½', 'error');
                    }
                } catch (error) {
                    updateResult(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
                }
            }, 500);
        }
        
        function showLocalStorage() {
            updateResult('æ­£åœ¨è¯»å–æœ¬åœ°å­˜å‚¨æ•°æ®...', 'info');
            
            setTimeout(() => {
                try {
                    let result = `ğŸ“‹ æœ¬åœ°å­˜å‚¨ä¸­çš„ç”¨æˆ·ç›¸å…³æ•°æ®\n\n`;
                    
                    // è·å–ç”¨æˆ·ç›¸å…³æ•°æ®
                    const userKeys = [
                        'linkaitiya_users',
                        'linkaitiya_current_user',
                        'linkaitiya_sessions',
                        'linkaitiya_user_profiles',
                        'linkaitiya_user_learning_data',
                        'linkaitiya_user_community_data',
                        'linkaitiya_user_settings'
                    ];
                    
                    let foundData = false;
                    userKeys.forEach(key => {
                        const value = localStorage.getItem(key);
                        if (value) {
                            foundData = true;
                            result += `${key}:\n`;
                            try {
                                const parsed = JSON.parse(value);
                                result += JSON.stringify(parsed, null, 2) + '\n\n';
                            } catch (e) {
                                result += value + '\n\n';
                            }
                        }
                    });
                    
                    if (!foundData) {
                        result += 'æœªæ‰¾åˆ°ç”¨æˆ·ç›¸å…³æ•°æ®\n';
                        result += 'è¯·ç¡®ä¿æ‚¨å·²æ³¨å†Œå¹¶ç™»å½•è´¦æˆ·';
                    }
                    
                    updateResult(result, 'info');
                } catch (error) {
                    updateResult(`âŒ è¯»å–å¤±è´¥: ${error.message}`, 'error');
                }
            }, 500);
        }
    </script>
</body>
</html>