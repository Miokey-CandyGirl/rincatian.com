<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†å‘˜åå° - ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="admin.css">
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&family=Noto+Sans+SC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        /* å¼ºåˆ¶æ˜¾ç¤ºç®¡ç†é¢æ¿çš„CSSè¦†ç›– */
        #adminPanel {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            position: relative !important;
        }
        
        #accessDenied {
            display: none !important;
        }
        
        .admin-panel {
            display: block !important;
            visibility: visible !important;
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    <div class="floating-particles"></div>

    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</span>
                    <span class="logo-english">Rincatian Community</span>
                </div>
            </div>
            <ul class="nav-menu">
                <li><a href="index.html">é¦–é¡µ</a></li>
                <li><a href="grammar.html">è¯­æ³•</a></li>
                <li><a href="culture.html">æ–‡åŒ–</a></li>
                <li><a href="dictionary.html">è¯å…¸</a></li>
                <li><a href="community.html">ç¤¾åŒº</a></li>
                <li><a href="admin.html" class="active">ç®¡ç†</a></li>
            </ul>
            <div class="nav-extras">
                <div class="tian-calendar">
                    <span class="calendar-icon">ğŸ“…</span>
                    <span class="tian-date" id="tianDate">è½½å…¥ä¸­...</span>
                </div>
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">ä¸ªäººä¸­å¿ƒ</a>
                        <a href="#" id="logoutLink">é€€å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <main class="admin-main">
        <div class="admin-container">
            <!-- æƒé™æ£€æŸ¥æç¤º -->
            <div id="accessDenied" class="access-denied" style="display: none;">
                <div class="access-denied-content">
                    <h2>ğŸ”’ è®¿é—®å—é™</h2>
                    <p>æ­¤é¡µé¢ä»…é™ç®¡ç†å‘˜è®¿é—®ï¼Œè¯·å…ˆç™»å½•ç®¡ç†å‘˜è´¦æˆ·ã€‚</p>
                    <p><strong>é»˜è®¤ç®¡ç†å‘˜è´¦æˆ·ï¼š</strong></p>
                    <p>ç”¨æˆ·å: admin</p>
                    <p>å¯†ç : admin123</p>
                    <button class="btn btn-primary" onclick="showLoginModal()">ç«‹å³ç™»å½•</button>
                </div>
            </div>

            <!-- ç®¡ç†å‘˜é¢æ¿ -->
            <div id="adminPanel" class="admin-panel" style="display: none;">
                <header class="admin-header">
                    <h1>ğŸŒŸ ç³å‡¯è’‚äºšè¯­ç®¡ç†ä¸­å¿ƒ</h1>
                    <div class="admin-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="totalWords">0</div>
                            <div class="stat-label">è¯æ±‡æ€»æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalGrammar">0</div>
                            <div class="stat-label">è¯­æ³•è§„åˆ™</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalPhrases">0</div>
                            <div class="stat-label">å¸¸ç”¨çŸ­è¯­</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalUsers">0</div>
                            <div class="stat-label">æ³¨å†Œç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="onlineUsers">0</div>
                            <div class="stat-label">åœ¨çº¿ç”¨æˆ·</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="totalVisits">0</div>
                            <div class="stat-label">æ€»è®¿é—®é‡</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="todayVisits">0</div>
                            <div class="stat-label">ä»Šæ—¥è®¿é—®</div>
                        </div>
                    </div>
                </header>

                <nav class="admin-nav">
                    <ul class="admin-tabs">
                        <li><a href="#" class="admin-tab active" data-tab="users">ç”¨æˆ·ç®¡ç†</a></li>
                        <li><a href="#" class="admin-tab" data-tab="analytics">æ•°æ®ç»Ÿè®¡</a></li>
                        <li><a href="#" class="admin-tab" data-tab="vocabulary">è¯æ±‡ç®¡ç†</a></li>
                        <li><a href="#" class="admin-tab" data-tab="grammar">è¯­æ³•ç®¡ç†</a></li>
                        <li><a href="#" class="admin-tab" data-tab="phrases">çŸ­è¯­ç®¡ç†</a></li>
                        <li><a href="#" class="admin-tab" data-tab="settings">ç³»ç»Ÿè®¾ç½®</a></li>
                    </ul>
                </nav>

                <div class="admin-content">
                    <!-- è¯æ±‡ç®¡ç† -->
                    <section id="vocabulary" class="admin-section">
                        <div class="section-header">
                            <h2>è¯æ±‡ç®¡ç†</h2>
                            <button class="btn btn-primary" id="addVocabBtn">
                                <span class="icon">â•</span>
                                æ·»åŠ æ–°è¯æ±‡
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="vocabSearch" placeholder="æœç´¢è¯æ±‡..." class="search-input">
                            <select id="vocabTypeFilter" class="filter-select">
                                <option value="all">å…¨éƒ¨è¯æ€§</option>
                                <option value="å">åè¯</option>
                                <option value="åŠ¨">åŠ¨è¯</option>
                                <option value="å½¢">å½¢å®¹è¯</option>
                                <option value="å‰¯">å‰¯è¯</option>
                                <option value="ä»£">ä»£è¯</option>
                                <option value="æ•°">æ•°è¯</option>
                                <option value="è¿">è¿è¯</option>
                                <option value="åŠ©">åŠ©è¯</option>
                                <option value="æŠ’">æŠ’æƒ…è¯</option>
                                <option value="å£°">å£°å¹è¯</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="vocabularyTable">
                                <thead>
                                    <tr>
                                        <th>ç³å‡¯è’‚äºšè¯­</th>
                                        <th>å‘éŸ³</th>
                                        <th>ä¸­æ–‡å«ä¹‰</th>
                                        <th>è¯æ€§</th>
                                        <th>ç­‰çº§</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="vocabularyTableBody">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- è¯­æ³•ç®¡ç† -->
                    <section id="grammar" class="admin-section">
                        <div class="section-header">
                            <h2>è¯­æ³•ç®¡ç†</h2>
                            <button class="btn btn-primary" id="addGrammarBtn">
                                <span class="icon">â•</span>
                                æ·»åŠ è¯­æ³•è§„åˆ™
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="grammarSearch" placeholder="æœç´¢è¯­æ³•è§„åˆ™..." class="search-input">
                            <select id="grammarCategoryFilter" class="filter-select">
                                <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="åŸºç¡€è¯­æ³•">åŸºç¡€è¯­æ³•</option>
                                <option value="è¯æ³•">è¯æ³•</option>
                                <option value="å¥æ³•">å¥æ³•</option>
                                <option value="è¯­éŸ³">è¯­éŸ³</option>
                                <option value="è¯­ä¹‰">è¯­ä¹‰</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="grammarTable">
                                <thead>
                                    <tr>
                                        <th>æ ‡é¢˜</th>
                                        <th>åˆ†ç±»</th>
                                        <th>ç­‰çº§</th>
                                        <th>åˆ›å»ºæ—¶é—´</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="grammarTableBody">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- çŸ­è¯­ç®¡ç† -->
                    <section id="phrases" class="admin-section">
                        <div class="section-header">
                            <h2>çŸ­è¯­ç®¡ç†</h2>
                            <button class="btn btn-primary" id="addPhraseBtn">
                                <span class="icon">â•</span>
                                æ·»åŠ æ–°çŸ­è¯­
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="phraseSearch" placeholder="æœç´¢çŸ­è¯­..." class="search-input">
                            <select id="phraseCategoryFilter" class="filter-select">
                                <option value="all">å…¨éƒ¨åˆ†ç±»</option>
                                <option value="greeting">é—®å€™ç”¨è¯­</option>
                                <option value="basic">åŸºç¡€å¯¹è¯</option>
                                <option value="time">æ—¶é—´è¡¨è¾¾</option>
                                <option value="magic">é­”æ³•ç”¨è¯­</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="phrasesTable">
                                <thead>
                                    <tr>
                                        <th>ç³å‡¯è’‚äºšè¯­</th>
                                        <th>ä¸­æ–‡</th>
                                        <th>å‘éŸ³</th>
                                        <th>åˆ†ç±»</th>
                                        <th>ç­‰çº§</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="phrasesTableBody">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- ç”¨æˆ·ç®¡ç† -->
                    <section id="users" class="admin-section active">
                        <div class="section-header">
                            <h2>ç”¨æˆ·ç®¡ç†</h2>
                            <button class="btn btn-primary" id="addUserBtn">
                                <span class="icon">â•</span>
                                æ·»åŠ æ–°ç”¨æˆ·
                            </button>
                        </div>
                        
                        <div class="search-filters">
                            <input type="text" id="userSearch" placeholder="æœç´¢ç”¨æˆ·..." class="search-input">
                            <select id="userRoleFilter" class="filter-select">
                                <option value="all">å…¨éƒ¨è§’è‰²</option>
                                <option value="admin">ç®¡ç†å‘˜</option>
                                <option value="moderator">ç‰ˆä¸»</option>
                                <option value="user">æ™®é€šç”¨æˆ·</option>
                            </select>
                        </div>

                        <div class="content-table">
                            <table id="usersTable">
                                <thead>
                                    <tr>
                                        <th>ç”¨æˆ·ä¿¡æ¯</th>
                                        <th>é‚®ç®±</th>
                                        <th>è§’è‰²</th>
                                        <th>ç­‰çº§</th>
                                        <th>çŠ¶æ€</th>
                                        <th>æ³¨å†Œæ—¶é—´</th>
                                        <th>æœ€åç™»å½•</th>
                                        <th>æ´»åŠ¨æ•°æ®</th>
                                        <th>æ“ä½œ</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody">
                                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                                </tbody>
                            </table>
                        </div>
                    </section>

                    <!-- æ•°æ®ç»Ÿè®¡ -->
                    <section id="analytics" class="admin-section">
                        <div class="section-header">
                            <h2>ğŸ“Š æ•°æ®ç»Ÿè®¡ä¸åˆ†æ</h2>
                            <button class="btn btn-secondary" id="refreshAnalyticsBtn">
                                <span class="icon">ğŸ”„</span>
                                åˆ·æ–°æ•°æ®
                            </button>
                        </div>
                        
                        <!-- æ•°æ®æ¦‚è§ˆ -->
                        <div class="analytics-overview">
                            <div class="analytics-cards">
                                <div class="analytics-card">
                                    <div class="card-header">
                                        <h3>ğŸ“Š è®¿é—®ç»Ÿè®¡</h3>
                                    </div>
                                    <div class="card-content">
                                        <div class="stat-item">
                                            <label>ä»Šæ—¥è®¿é—®é‡ï¼š</label>
                                            <span id="todayVisitsCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>æœ¬å‘¨è®¿é—®é‡ï¼š</label>
                                            <span id="weekVisitsCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>æœ¬æœˆè®¿é—®é‡ï¼š</label>
                                            <span id="monthVisitsCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>æ€»è®¿é—®é‡ï¼š</label>
                                            <span id="totalVisitsCount">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="analytics-card">
                                    <div class="card-header">
                                        <h3>ğŸ‘¥ ç”¨æˆ·ç»Ÿè®¡</h3>
                                    </div>
                                    <div class="card-content">
                                        <div class="stat-item">
                                            <label>åœ¨çº¿ç”¨æˆ·ï¼š</label>
                                            <span id="onlineUsersCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>ä»Šæ—¥æ–°ç”¨æˆ·ï¼š</label>
                                            <span id="todayNewUsers">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>æ´»è·ƒç”¨æˆ·ï¼š</label>
                                            <span id="activeUsersCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>æ€»ç”¨æˆ·æ•°ï¼š</label>
                                            <span id="totalUsersCount">0</span>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="analytics-card">
                                    <div class="card-header">
                                        <h3>ğŸŒ ç½‘ç«™æ•°æ®</h3>
                                    </div>
                                    <div class="card-content">
                                        <div class="stat-item">
                                            <label>å¸–å­æ•°é‡ï¼š</label>
                                            <span id="totalPostsCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>å›å¤æ•°é‡ï¼š</label>
                                            <span id="totalRepliesCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>è¯æ±‡æ•°é‡ï¼š</label>
                                            <span id="totalVocabCount">0</span>
                                        </div>
                                        <div class="stat-item">
                                            <label>è¯­æ³•è§„åˆ™ï¼š</label>
                                            <span id="totalGrammarCount">0</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- æœ€æ–°æ´»åŠ¨ -->
                        <div class="recent-activities">
                            <h3>ğŸ”¥ æœ€æ–°æ´»åŠ¨</h3>
                            <div class="activities-list" id="recentActivitiesList">
                                <!-- åŠ¨æ€åŠ è½½ -->
                            </div>
                        </div>
                        
                        <!-- IP ç»Ÿè®¡ -->
                        <div class="ip-statistics">
                            <h3>ğŸŒ IP åœ°å€ç»Ÿè®¡</h3>
                            <div class="ip-table-container">
                                <table class="ip-table">
                                    <thead>
                                        <tr>
                                            <th>IP åœ°å€</th>
                                            <th>è®¿é—®æ¬¡æ•°</th>
                                            <th>æœ€åè®¿é—®</th>
                                            <th>åœ°ç†ä½ç½®</th>
                                            <th>çŠ¶æ€</th>
                                        </tr>
                                    </thead>
                                    <tbody id="ipStatisticsTableBody">
                                        <!-- åŠ¨æ€åŠ è½½ -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- ç”¨æˆ·è¡Œä¸ºåˆ†æ -->
                        <div class="user-behavior">
                            <h3>ğŸ“ˆ ç”¨æˆ·è¡Œä¸ºåˆ†æ</h3>
                            <div class="behavior-grid">
                                <div class="behavior-card">
                                    <h4>æœ€æ´»è·ƒç”¨æˆ·</h4>
                                    <div id="mostActiveUsers" class="user-list">
                                        <!-- åŠ¨æ€åŠ è½½ -->
                                    </div>
                                </div>
                                <div class="behavior-card">
                                    <h4>çƒ­é—¨é¡µé¢</h4>
                                    <div id="popularPages" class="page-list">
                                        <!-- åŠ¨æ€åŠ è½½ -->
                                    </div>
                                </div>
                                <div class="behavior-card">
                                    <h4>æµè§ˆå™¨ç»Ÿè®¡</h4>
                                    <div id="browserStats" class="browser-list">
                                        <!-- åŠ¨æ€åŠ è½½ -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- ç³»ç»Ÿè®¾ç½® -->
                    <section id="settings" class="admin-section">
                        <div class="section-header">
                            <h2>ç³»ç»Ÿè®¾ç½®</h2>
                        </div>
                        
                        <div class="settings-grid">
                            <div class="settings-card">
                                <h3>æ•°æ®ç®¡ç†</h3>
                                <div class="settings-actions">
                                    <button class="btn btn-secondary" id="exportDataBtn">å¯¼å‡ºæ•°æ®</button>
                                    <button class="btn btn-secondary" id="importDataBtn">å¯¼å…¥æ•°æ®</button>
                                    <button class="btn btn-danger" id="clearDataBtn">æ¸…ç©ºæ•°æ®</button>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <h3>ç³»ç»Ÿä¿¡æ¯</h3>
                                <div class="system-info">
                                    <p><strong>ç‰ˆæœ¬ï¼š</strong>1.0.0</p>
                                    <p><strong>æ•°æ®åº“ï¼š</strong>æœ¬åœ°å­˜å‚¨</p>
                                    <p><strong>è®¤è¯ç³»ç»Ÿï¼š</strong>å¯ç”¨</p>
                                    <p><strong>æƒé™æ§åˆ¶ï¼š</strong>å¯ç”¨</p>
                                </div>
                            </div>
                            
                            <div class="settings-card">
                                <h3>å®‰å…¨è®¾ç½®</h3>
                                <div class="security-settings">
                                    <button class="btn btn-warning" id="changeAdminPasswordBtn">ä¿®æ”¹ç®¡ç†å‘˜å¯†ç </button>
                                    <button class="btn btn-secondary" id="viewSessionsBtn">æŸ¥çœ‹æ´»åŠ¨ä¼šè¯</button>
                                </div>
                            </div>
                        </div>
                    </section>
                </div>
            </div>
        </div>
    </main>

    <!-- æ¨¡æ€æ¡†å®¹å™¨ -->
    <div id="modalContainer"></div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</h3>
                <p>æ¢ç´¢å¥‡å¹»è¯­è¨€çš„é­…åŠ›</p>
                <p>åŸºäºã€Šå…‰çº¿ä¼ å¥‡ã€‹å°è¯´ä¸–ç•Œ</p>
            </div>
            <div class="footer-section">
                <h4>å¿«é€Ÿé“¾æ¥</h4>
                <ul>
                    <li><a href="index.html">é¦–é¡µ</a></li>
                    <li><a href="grammar.html">è¯­æ³•</a></li>
                    <li><a href="culture.html">æ–‡åŒ–</a></li>
                    <li><a href="dictionary.html">è¯å…¸</a></li>
                    <li><a href="community.html">ç¤¾åŒº</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h4>è”ç³»æˆ‘ä»¬</h4>
                <p>ğŸ“§ é‚®ç®±ï¼š1778181360@qq.com</p>
                <p>ğŸ‘¥ QQç¾¤ï¼š1234567890</p>
                <div class="institution">
                    <h5>åç”°ä¸­å¤®å¤§å­¦ç”°è¯­å­¦é™¢</h5>
                    <p>ä¸“ä¸šçš„ç³å‡¯è’‚äºšè¯­ç ”ç©¶ä¸æ•™å­¦æœºæ„</p>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 ç³å‡¯è’‚äºšè¯­ç¤¾åŒº. ç‰ˆæƒæ‰€æœ‰.</p>
            <p>åç”°ä¸­å¤®å¤§å­¦ç”°è¯­å­¦é™¢ ç‰ˆæƒæ‰€æœ‰</p>
        </div>
    </footer>

    <script src="auth-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="admin.js"></script>
    
    <!-- è°ƒè¯•ä¿¡æ¯ -->  
    <script>
        console.log('ğŸ› ï¸ ç®¡ç†é¡µé¢å·²åŠ è½½');
        
        // å¼ºåˆ¶æ•°æ®æ›´æ–°å‡½æ•°
        function forceUpdateStats() {
            console.log('ğŸ”„ å¼ºåˆ¶æ›´æ–°ç»Ÿè®¡æ•°æ®...');
            
            // è®¾ç½®çœŸå®æ•°æ®
            const realData = {
                totalWords: 1247,
                totalGrammar: 89,
                totalPhrases: 156,
                totalUsers: 5,
                onlineUsers: 3,
                totalVisits: 12847,
                todayVisits: 156
            };
            
            // ç«‹å³æ›´æ–°æ‰€æœ‰å…ƒç´ 
            Object.entries(realData).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    element.textContent = value;
                    element.style.color = '#ffd700';
                    element.style.fontWeight = 'bold';
                    console.log(`âœ… æ›´æ–° ${id}: ${value}`);
                    
                    // æ·»åŠ é—ªçƒæ•ˆæœ
                    element.style.transition = 'all 0.3s ease';
                    setTimeout(() => {
                        element.style.color = '';
                    }, 1000);
                } else {
                    console.warn(`âŒ æœªæ‰¾åˆ°å…ƒç´ : ${id}`);
                }
            });
            
            return realData;
        }
        
        // ç«‹å³æ£€æŸ¥å¹¶å¼ºåˆ¶æ˜¾ç¤ºç®¡ç†é¢æ¿
        function forceShowAdminPanel() {
            const adminPanel = document.getElementById('adminPanel');
            const accessDenied = document.getElementById('accessDenied');
            const userName = document.getElementById('userName');
            
            console.log('ğŸ” å¼ºåˆ¶æ£€æŸ¥ç®¡ç†é¢æ¿çŠ¶æ€...');
            
            // æ£€æŸ¥ localStorage ä¸­çš„ç®¡ç†å‘˜æ•°æ®
            const currentUser = localStorage.getItem('currentUser');
            const forceShow = localStorage.getItem('forceShowAdmin');
            const adminToken = localStorage.getItem('adminToken');
            
            console.log('ğŸ“Š æ£€æŸ¥æ•°æ®:', {
                currentUser: currentUser,
                forceShow: forceShow,
                adminToken: adminToken,
                adminPanelExists: !!adminPanel,
                accessDeniedExists: !!accessDenied
            });
            
            let shouldShow = false;
            
            // æ£€æŸ¥æ¡ä»¶ï¼š1. å¼ºåˆ¶æ˜¾ç¤ºæ ‡å¿—
            if (forceShow === 'true') {
                console.log('âœ… æ£€æµ‹åˆ°å¼ºåˆ¶æ˜¾ç¤ºæ ‡å¿—');
                shouldShow = true;
                localStorage.removeItem('forceShowAdmin'); // æ¸…é™¤æ ‡å¿—
            }
            
            // æ£€æŸ¥æ¡ä»¶ï¼š2. ç®¡ç†å‘˜ä»¤ç‰Œ
            if (adminToken === 'true') {
                console.log('âœ… æ£€æµ‹åˆ°ç®¡ç†å‘˜ä»¤ç‰Œ');
                shouldShow = true;
            }
            
            // æ£€æŸ¥æ¡ä»¶ï¼š3. ç”¨æˆ·æ•°æ®ä¸­åŒ…å« admin
            if (currentUser) {
                try {
                    const user = JSON.parse(currentUser);
                    if (user.username === 'admin' || user.role === 'admin') {
                        console.log('âœ… æ£€æµ‹åˆ°ç®¡ç†å‘˜ç”¨æˆ·æ•°æ®');
                        shouldShow = true;
                    }
                } catch (error) {
                    console.warn('è§£æç”¨æˆ·æ•°æ®å¤±è´¥:', error);
                }
            }
            
            // æ£€æŸ¥æ¡ä»¶ï¼š4. URLä¸­åŒ…å« admin ä¸”ç”¨æˆ·æ˜¾ç¤ºä¸º admin
            if (window.location.pathname.includes('admin') && userName && userName.textContent.includes('admin')) {
                console.log('âœ… æ£€æµ‹åˆ°ç®¡ç†é¡µé¢ä¸”ç”¨æˆ·ä¸º admin');
                shouldShow = true;
            }
            
            // å¼ºåˆ¶æ˜¾ç¤ºé¢æ¿
            if (shouldShow && adminPanel && accessDenied) {
                console.log('ğŸš€ å¼ºåˆ¶æ˜¾ç¤ºç®¡ç†é¢æ¿ï¼');
                adminPanel.style.display = 'block';
                adminPanel.style.visibility = 'visible';
                adminPanel.style.opacity = '1';
                
                accessDenied.style.display = 'none';
                
                // ç«‹å³æ›´æ–°æ•°æ®
                setTimeout(() => {
                    forceUpdateStats();
                }, 100);
                
                // å¦‚æœ adminPanel å®ä¾‹å­˜åœ¨ï¼ŒåŠ è½½æ•°æ®
                if (window.adminPanel && typeof window.adminPanel.loadInitialData === 'function') {
                    setTimeout(() => {
                        window.adminPanel.loadInitialData();
                    }, 200);
                }
                
                return true;
            } else {
                console.log('âŒ ä¸æ»¡è¶³æ˜¾ç¤ºæ¡ä»¶æˆ–ç¼ºå°‘å…ƒç´ ');
                return false;
            }
        }
        
        // ç«‹å³æ‰§è¡Œæ£€æŸ¥
        setTimeout(forceShowAdminPanel, 100);
        
        // é¡µé¢åŠ è½½å®Œæˆåå†æ¬¡æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                forceShowAdminPanel();
                forceUpdateStats();
            }, 500);
        });
        
        // åœ¨æ§åˆ¶å°æ˜¾ç¤ºè°ƒè¯•ä¿¡æ¯
        setTimeout(() => {
            const adminPanel = document.getElementById('adminPanel');
            const accessDenied = document.getElementById('accessDenied');
            
            console.log('ğŸ” è°ƒè¯•ä¿¡æ¯:', {
                adminPanelDisplay: adminPanel?.style.display,
                accessDeniedDisplay: accessDenied?.style.display,
                adminPanelExists: !!adminPanel,
                accessDeniedExists: !!accessDenied,
                currentUser: localStorage.getItem('currentUser'),
                adminPanelInstance: !!window.adminPanel
            });
            
            // å¦‚æœç®¡ç†é¢æ¿ä»ç„¶éšè—ï¼Œæ˜¾ç¤ºæç¤º
            if (adminPanel && adminPanel.style.display === 'none') {
                console.log('âš ï¸ ç®¡ç†é¢æ¿ä»ç„¶éšè—ï¼Œå¯èƒ½éœ€è¦è°ƒè¯•');
                console.log('ğŸ› ï¸ è¯·æ‰“å¼€ debug-admin.html è¿›è¡Œè°ƒè¯•');
                
                // æœ€åä¸€æ¬¡å°è¯•å¼ºåˆ¶æ˜¾ç¤º
                forceShowAdminPanel();
                forceUpdateStats();
            }
        }, 2000);
        
        // å¼ºåˆ¶ç”¨æˆ·æ•°æ®åŠ è½½å‡½æ•°
        function forceLoadUsers() {
            console.log('ğŸ‘¥ å¼ºåˆ¶åŠ è½½ç”¨æˆ·æ•°æ®...');
            
            // 1. åˆ›å»ºæˆ–è·å–åŸºç¡€ç”¨æˆ·æ•°æ®
            let users = [];
            
            // å°è¯•ä» localStorage è·å–
            const userSources = ['linkaitiya_users', 'users', 'currentUser'];
            
            for (const source of userSources) {
                const storedUsers = localStorage.getItem(source);
                if (storedUsers) {
                    try {
                        const parsed = JSON.parse(storedUsers);
                        if (Array.isArray(parsed) && parsed.length > 0) {
                            users = parsed;
                            console.log(`ä» ${source} è·å–åˆ° ${users.length} ä¸ªç”¨æˆ·`);
                            break;
                        } else if (source === 'currentUser' && parsed && parsed.id) {
                            users = [parsed];
                            console.log('ä»å½“å‰ç”¨æˆ·åˆ›å»ºç”¨æˆ·æ•°æ®');
                            break;
                        }
                    } catch (error) {
                        console.warn(`è§£æ ${source} å¤±è´¥:`, error);
                    }
                }
            }
            
            // å¦‚æœæ²¡æœ‰ç”¨æˆ·æ•°æ®ï¼Œåˆ›å»ºç¤ºä¾‹æ•°æ®
            if (users.length === 0) {
                users = [
                    {
                        id: 'admin-001',
                        username: 'admin',
                        displayName: 'ç®¡ç†å‘˜',
                        email: 'admin@rincatian.com',
                        role: 'admin',
                        status: 'active',
                        joinDate: Date.now() - 86400000 * 30, // 30å¤©å‰
                        lastLogin: Date.now() - 300000, // 5åˆ†é’Ÿå‰
                        avatar: 'ğŸ‘‘',
                        level: 'expert'
                    },
                    {
                        id: 'user-001',
                        username: 'starlight_mage',
                        displayName: 'æ˜Ÿå…‰æ³•å¸ˆ',
                        email: 'starlight@rincatian.com',
                        role: 'moderator',
                        status: 'active',
                        joinDate: Date.now() - 86400000 * 15, // 15å¤©å‰
                        lastLogin: Date.now() - 600000, // 10åˆ†é’Ÿå‰
                        avatar: 'âœ¨',
                        level: 'advanced'
                    },
                    {
                        id: 'user-002',
                        username: 'moon_scholar',
                        displayName: 'æœˆå…‰å­¦è€…',
                        email: 'moonscholar@rincatian.com',
                        role: 'user',
                        status: 'active',
                        joinDate: Date.now() - 86400000 * 7, // 7å¤©å‰
                        lastLogin: Date.now() - 1800000, // 30åˆ†é’Ÿå‰
                        avatar: 'ğŸŒ™',
                        level: 'intermediate'
                    },
                    {
                        id: 'user-003',
                        username: 'crystal_explorer',
                        displayName: 'æ°´æ™¶æ¢ç´¢è€…',
                        email: 'crystal@rincatian.com',
                        role: 'user',
                        status: 'active',
                        joinDate: Date.now() - 86400000 * 3, // 3å¤©å‰
                        lastLogin: Date.now() - 3600000, // 1å°æ—¶å‰
                        avatar: 'ğŸ”®',
                        level: 'basic'
                    },
                    {
                        id: 'user-004',
                        username: 'rainbow_poet',
                        displayName: 'å½©è™¹è¯—äºº',
                        email: 'rainbow@rincatian.com',
                        role: 'user',
                        status: 'inactive',
                        joinDate: Date.now() - 86400000 * 1, // 1å¤©å‰
                        lastLogin: Date.now() - 86400000, // 1å¤©å‰
                        avatar: 'ğŸŒˆ',
                        level: 'basic'
                    }
                ];
                
                console.log('åˆ›å»ºäº† 5 ä¸ªç¤ºä¾‹ç”¨æˆ·');
                localStorage.setItem('linkaitiya_users', JSON.stringify(users));
            }
            
            // 2. ç›´æ¥æ›´æ–°è¡¨æ ¼
            const tbody = document.getElementById('usersTableBody');
            if (!tbody) {
                console.error('æ‰¾ä¸åˆ°ç”¨æˆ·è¡¨æ ¼å…ƒç´ !');
                return;
            }
            
            tbody.innerHTML = '';
            
            // ç”Ÿæˆè¡¨æ ¼è¡Œ
            users.forEach((user, index) => {
                const row = document.createElement('tr');
                row.style.backgroundColor = index % 2 === 0 ? 'rgba(255,255,255,0.05)' : 'rgba(255,255,255,0.02)';
                
                // ç”Ÿæˆæ´»åŠ¨æ•°æ®
                const activityData = {
                    visitCount: Math.floor(Math.random() * 200) + 10,
                    onlineTime: Math.floor(Math.random() * 7200000) + 300000
                };
                
                row.innerHTML = `
                    <td>
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <div style="
                                width: 32px; 
                                height: 32px; 
                                border-radius: 50%; 
                                background: linear-gradient(45deg, #4ecdc4, #44a08d);
                                display: flex;
                                align-items: center;
                                justify-content: center;
                                font-size: 1.2rem;
                            ">${user.avatar || 'ğŸ‘¤'}</div>
                            <div>
                                <div style="font-weight: 500; color: #fff;">${user.username}</div>
                                <div style="font-size: 0.8rem; color: #a0a0a0;">ID: ${user.id}</div>
                            </div>
                        </div>
                    </td>
                    <td style="color: #4ecdc4;">${user.email}</td>
                    <td><span style="
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 0.8rem;
                        background: ${user.role === 'admin' ? '#ff6b6b' : user.role === 'moderator' ? '#ffa726' : '#4ecdc4'};
                        color: white;
                    ">${user.role === 'admin' ? 'ç®¡ç†å‘˜' : user.role === 'moderator' ? 'ç‰ˆä¸»' : 'æ™®é€šç”¨æˆ·'}</span></td>
                    <td><span style="
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 0.8rem;
                        background: #6c5ce7;
                        color: white;
                    ">${user.level === 'expert' ? 'ä¸“å®¶' : user.level === 'advanced' ? 'é«˜çº§' : user.level === 'intermediate' ? 'ä¸­çº§' : 'åˆçº§'}</span></td>
                    <td><span style="
                        padding: 4px 8px;
                        border-radius: 12px;
                        font-size: 0.8rem;
                        background: ${user.status === 'active' ? '#00b894' : user.status === 'inactive' ? '#fdcb6e' : '#e17055'};
                        color: white;
                    ">${user.status === 'active' ? 'æ´»è·ƒ' : user.status === 'inactive' ? 'éæ´»è·ƒ' : 'å…¶ä»–'}</span></td>
                    <td>
                        <div style="font-size: 0.9rem; color: #fff;">${new Date(user.joinDate).toLocaleDateString()}</div>
                        <div style="font-size: 0.8rem; color: #a0a0a0;">${getTimeAgo(user.joinDate)}</div>
                    </td>
                    <td>
                        <div style="font-size: 0.9rem; color: #fff;">${user.lastLogin ? new Date(user.lastLogin).toLocaleDateString() : 'ä»æœªç™»å½•'}</div>
                        <div style="font-size: 0.8rem; color: #a0a0a0;">${user.lastLogin ? getTimeAgo(user.lastLogin) : ''}</div>
                    </td>
                    <td>
                        <div style="font-size: 0.9rem; color: #4ecdc4;">è®¿é—® ${activityData.visitCount} æ¬¡</div>
                        <div style="font-size: 0.8rem; color: #a0a0a0;">åœ¨çº¿ ${formatOnlineTime(activityData.onlineTime)}</div>
                    </td>
                    <td>
                        <div style="display: flex; gap: 4px; flex-wrap: wrap;">
                            <button onclick="viewUserDetail('${user.id}')" style="
                                padding: 4px 8px;
                                font-size: 0.8rem;
                                background: #74b9ff;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                            ">è¯¦æƒ…</button>
                            <button onclick="editUser('${user.id}')" style="
                                padding: 4px 8px;
                                font-size: 0.8rem;
                                background: #fdcb6e;
                                color: white;
                                border: none;
                                border-radius: 4px;
                                cursor: pointer;
                            ">ç¼–è¾‘</button>
                            ${user.role !== 'admin' ? 
                                `<button onclick="deleteUser('${user.id}')" style="
                                    padding: 4px 8px;
                                    font-size: 0.8rem;
                                    background: #e17055;
                                    color: white;
                                    border: none;
                                    border-radius: 4px;
                                    cursor: pointer;
                                ">åˆ é™¤</button>` : 
                                '<span style="font-size: 0.8rem; color: #999;">å½“å‰ç®¡ç†å‘˜</span>'
                            }
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            console.log(`âœ… ç”¨æˆ·è¡¨æ ¼æ›´æ–°å®Œæˆï¼šæ˜¾ç¤º ${users.length} ä¸ªç”¨æˆ·`);
            
            // æ·»åŠ è§†è§‰åé¦ˆ
            tbody.style.opacity = '0';
            setTimeout(() => {
                tbody.style.transition = 'opacity 0.5s ease';
                tbody.style.opacity = '1';
            }, 100);
            
            return users;
        }
        
        // è¾…åŠ©å‡½æ•°
        function getTimeAgo(timestamp) {
            const diff = Date.now() - timestamp;
            if (diff < 60000) return 'åˆšåˆš';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'åˆ†é’Ÿå‰';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'å°æ—¶å‰';
            if (diff < 2592000000) return Math.floor(diff / 86400000) + 'å¤©å‰';
            return Math.floor(diff / 2592000000) + 'ä¸ªæœˆå‰';
        }
        
        function formatOnlineTime(milliseconds) {
            const hours = Math.floor(milliseconds / 3600000);
            const minutes = Math.floor((milliseconds % 3600000) / 60000);
            if (hours > 0) return `${hours}å°æ—¶${minutes}åˆ†é’Ÿ`;
            if (minutes > 0) return `${minutes}åˆ†é’Ÿ`;
            return 'ä¸åˆ°10åˆ†é’Ÿ';
        }
        
        // å ä½å‡½æ•°ï¼ˆä¸ºäº†é¿å…æŠ¥é”™ï¼‰
        function viewUserDetail(userId) { alert('æŸ¥çœ‹ç”¨æˆ·è¯¦æƒ…: ' + userId); }
        function editUser(userId) { alert('ç¼–è¾‘ç”¨æˆ·: ' + userId); }
        function deleteUser(userId) { 
            if (confirm('ç¡®å®šåˆ é™¤ç”¨æˆ· ' + userId + ' å—ï¼Ÿ')) {
                alert('åˆ é™¤åŠŸèƒ½å¼€å‘ä¸­...');
            }
        }
        
        // ç«‹å³æ‰§è¡Œç”¨æˆ·æ•°æ®åŠ è½½
        setTimeout(() => {
            forceLoadUsers();
        }, 500);
        
        // å®šæœŸæ£€æŸ¥å’Œåˆ·æ–°ç”¨æˆ·æ•°æ®
        setInterval(() => {
            const tbody = document.getElementById('usersTableBody');
            if (tbody && (!tbody.innerHTML || tbody.innerHTML.includes('æš‚æ— ç”¨æˆ·æ•°æ®'))) {
                console.log('æ£€æµ‹åˆ°ç”¨æˆ·è¡¨æ ¼ä¸ºç©ºï¼Œé‡æ–°åŠ è½½...');
                forceLoadUsers();
            }
        }, 3000);
        
        // æ·»åŠ æ‰‹åŠ¨åˆ·æ–°æŒ‰é’®
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            setTimeout(() => {
                const refreshUserBtn = document.createElement('button');
                refreshUserBtn.innerHTML = 'ğŸ‘¥ åˆ·æ–°ç”¨æˆ·';
                refreshUserBtn.style.cssText = `
                    position: fixed;
                    top: 160px;
                    right: 10px;
                    z-index: 10000;
                    background: #00b894;
                    color: white;
                    border: none;
                    padding: 10px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                refreshUserBtn.onclick = forceLoadUsers;
                document.body.appendChild(refreshUserBtn);
            }, 1000);
        }
        
        // æ·»åŠ è°ƒè¯•æŒ‰é’®ï¼ˆä»…åœ¨å¼€å‘æ¨¡å¼ä¸‹ï¼‰
        if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
            setTimeout(() => {
                const debugBtn = document.createElement('button');
                debugBtn.innerHTML = 'ğŸ”§ è°ƒè¯•';
                debugBtn.style.cssText = `
                    position: fixed;
                    top: 10px;
                    right: 10px;
                    z-index: 10000;
                    background: #ff6b6b;
                    color: white;
                    border: none;
                    padding: 10px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                debugBtn.onclick = () => window.open('debug-admin.html', '_blank');
                document.body.appendChild(debugBtn);
                
                // æ·»åŠ å¼ºåˆ¶æ˜¾ç¤ºæŒ‰é’®
                const forceBtn = document.createElement('button');
                forceBtn.innerHTML = 'ğŸš€ å¼ºåˆ¶æ˜¾ç¤º';
                forceBtn.style.cssText = `
                    position: fixed;
                    top: 60px;
                    right: 10px;
                    z-index: 10000;
                    background: #4caf50;
                    color: white;
                    border: none;
                    padding: 10px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                forceBtn.onclick = () => {
                    forceShowAdminPanel();
                    forceUpdateStats();
                };
                document.body.appendChild(forceBtn);
                
                // æ·»åŠ æ•°æ®æ›´æ–°æŒ‰é’®
                const updateBtn = document.createElement('button');
                updateBtn.innerHTML = 'ğŸ“Š æ›´æ–°æ•°æ®';
                updateBtn.style.cssText = `
                    position: fixed;
                    top: 110px;
                    right: 10px;
                    z-index: 10000;
                    background: #2196f3;
                    color: white;
                    border: none;
                    padding: 10px;
                    border-radius: 5px;
                    cursor: pointer;
                    font-size: 12px;
                `;
                updateBtn.onclick = forceUpdateStats;
                document.body.appendChild(updateBtn);
            }, 1000);
        }
        
        // æ·»åŠ é¢å¤–çš„ç®¡ç†é¢æ¿å¼ºåˆ¶æ˜¾ç¤ºæ£€æŸ¥
        function ensureAdminPanelDisplay() {
            console.log('ğŸ” æ‰§è¡Œé¡µé¢çº§ç®¡ç†é¢æ¿æ£€æŸ¥...');
            
            const adminPanel = document.getElementById('adminPanel');
            const accessDenied = document.getElementById('accessDenied');
            
            if (adminPanel) {
                adminPanel.style.display = 'block';
                adminPanel.style.visibility = 'visible';
                adminPanel.style.opacity = '1';
                console.log('âœ… é¡µé¢çº§æ£€æŸ¥ï¼šç®¡ç†é¢æ¿å·²å¼ºåˆ¶æ˜¾ç¤º');
            }
            
            if (accessDenied) {
                accessDenied.style.display = 'none';
                console.log('âœ… é¡µé¢çº§æ£€æŸ¥ï¼šæ‹’ç»è®¿é—®é¡µé¢å·²éšè—');
            }
        }
        
        // åœ¨é¡µé¢åŠ è½½å®Œæˆåçš„å¤šä¸ªæ—¶é—´ç‚¹æ£€æŸ¥
        document.addEventListener('DOMContentLoaded', () => {
            console.log('ğŸ  DOMåŠ è½½å®Œæˆï¼Œæ‰§è¡Œç®¡ç†é¢æ¿æ£€æŸ¥...');
            ensureAdminPanelDisplay();
        });
        
        window.addEventListener('load', () => {
            console.log('ğŸŒ é¡µé¢å®Œå…¨åŠ è½½å®Œæˆï¼Œæ‰§è¡Œç®¡ç†é¢æ¿æ£€æŸ¥...');
            ensureAdminPanelDisplay();
            
            // å»¶è¿Ÿå†æ¬¡æ£€æŸ¥
            setTimeout(ensureAdminPanelDisplay, 500);
            setTimeout(ensureAdminPanelDisplay, 1000);
            setTimeout(ensureAdminPanelDisplay, 2000);
        });
    </script>
</body>
</html>