<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>社区按钮测试 - 琳凯蒂亚语</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="community.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 120px auto 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-align: center;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .test-button {
            display: inline-block;
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(45deg, #ffd700, #4ecdc4);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .log-container {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: left;
        }
        
        .log-item {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-left: 3px solid #ffd700;
            background: rgba(255, 255, 255, 0.05);
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- 导航栏 -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">琳凯蒂亚语社区</span>
                    <span class="logo-english">Community Test</span>
                </div>
            </div>
            <div class="nav-extras">
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">登录</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">注册</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">个人中心</a>
                        <a href="#" id="logoutLink">退出</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="test-container">
        <h1>🧪 社区按钮功能测试</h1>
        <p>测试各个按钮是否能正常工作</p>
        
        <div class="test-section">
            <h3>认证系统测试</h3>
            <button class="test-button" onclick="testLogin()">测试登录</button>
            <button class="test-button" onclick="testRegister()">测试注册</button>
            <button class="test-button" onclick="testLogout()">测试退出</button>
            <button class="test-button" onclick="checkAuthStatus()">检查认证状态</button>
        </div>
        
        <div class="test-section">
            <h3>社区功能测试</h3>
            <button class="test-button" id="newPostBtn">发布新话题</button>
            <button class="test-button" onclick="testNewPostModal()">测试发布模态框</button>
            <button class="test-button" onclick="testLoginPrompt()">测试登录提示</button>
        </div>
        
        <div class="test-section">
            <h3>系统检查</h3>
            <button class="test-button" onclick="checkSystems()">检查系统加载</button>
            <button class="test-button" onclick="checkFunctions()">检查函数定义</button>
            <button class="test-button" onclick="clearLog()">清空日志</button>
        </div>
        
        <div class="log-container">
            <h4>🔍 测试日志</h4>
            <div id="testLog"></div>
        </div>
    </div>

    <!-- 引入脚本 -->
    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>

    <script>
        // 日志记录函数
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? '❌' : type === 'success' ? '✅' : type === 'warning' ? '⚠️' : 'ℹ️';
            
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `[${timestamp}] ${icon} ${message}`;
            
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[测试] ${message}`);
        }

        // 等待页面加载完成
        document.addEventListener('DOMContentLoaded', function() {
            log('页面加载完成，开始初始化测试环境');
            
            setTimeout(() => {
                checkSystems();
                checkFunctions();
                log('初始化完成，可以开始测试');
            }, 1000);
        });

        // 测试登录功能
        async function testLogin() {
            log('开始测试登录功能...');
            
            if (!window.authSystem) {
                log('认证系统未加载，无法测试登录', 'error');
                return;
            }
            
            try {
                // 尝试登录测试管理员账户
                const result = await window.authSystem.login({
                    username: 'admin',
                    password: 'admin123'
                });
                
                if (result.success) {
                    log('登录测试成功！', 'success');
                    log(`当前用户: ${window.authSystem.currentUser.username}`);
                } else {
                    log(`登录测试失败: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`登录测试异常: ${error.message}`, 'error');
            }
        }

        // 测试注册功能
        async function testRegister() {
            log('开始测试注册功能...');
            
            if (!window.authSystem) {
                log('认证系统未加载，无法测试注册', 'error');
                return;
            }
            
            try {
                const testUsername = 'test_' + Date.now();
                const result = await window.authSystem.register({
                    username: testUsername,
                    email: `${testUsername}@test.com`,
                    password: 'test123'
                });
                
                if (result.success) {
                    log('注册测试成功！', 'success');
                    log(`新用户: ${testUsername}`);
                } else {
                    log(`注册测试失败: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`注册测试异常: ${error.message}`, 'error');
            }
        }

        // 测试退出功能
        function testLogout() {
            log('开始测试退出功能...');
            
            if (!window.authSystem) {
                log('认证系统未加载，无法测试退出', 'error');
                return;
            }
            
            try {
                const result = window.authSystem.logout();
                if (result.success) {
                    log('退出测试成功！', 'success');
                } else {
                    log('退出测试失败', 'error');
                }
            } catch (error) {
                log(`退出测试异常: ${error.message}`, 'error');
            }
        }

        // 检查认证状态
        function checkAuthStatus() {
            log('检查当前认证状态...');
            
            if (window.authSystem) {
                if (window.authSystem.currentUser) {
                    log(`✅ 已登录用户: ${window.authSystem.currentUser.username} (${window.authSystem.currentUser.role})`, 'success');
                } else {
                    log('⚠️ 用户未登录', 'warning');
                }
            } else {
                log('❌ 认证系统未加载', 'error');
            }
            
            if (window.communitySystem) {
                if (window.communitySystem.currentUser) {
                    log(`✅ 社区系统用户: ${window.communitySystem.currentUser.username}`, 'success');
                } else {
                    log('⚠️ 社区系统无用户', 'warning');
                }
            } else {
                log('❌ 社区系统未加载', 'error');
            }
        }

        // 测试发布新话题模态框
        function testNewPostModal() {
            log('测试发布新话题模态框...');
            
            if (typeof showNewPostModal === 'function') {
                try {
                    showNewPostModal();
                    log('✅ 发布模态框函数调用成功', 'success');
                } catch (error) {
                    log(`❌ 发布模态框调用失败: ${error.message}`, 'error');
                }
            } else {
                log('❌ showNewPostModal 函数未定义', 'error');
            }
        }

        // 测试登录提示
        function testLoginPrompt() {
            log('测试登录提示...');
            
            if (typeof showLoginPrompt === 'function') {
                try {
                    showLoginPrompt();
                    log('✅ 登录提示函数调用成功', 'success');
                } catch (error) {
                    log(`❌ 登录提示调用失败: ${error.message}`, 'error');
                }
            } else {
                log('❌ showLoginPrompt 函数未定义', 'error');
            }
        }

        // 检查系统加载
        function checkSystems() {
            log('检查系统加载状态...');
            
            const systems = [
                { name: 'window.authSystem', obj: window.authSystem },
                { name: 'window.communitySystem', obj: window.communitySystem },
                { name: 'window.contentManager', obj: window.contentManager }
            ];
            
            systems.forEach(system => {
                if (system.obj) {
                    log(`✅ ${system.name} 已加载`, 'success');
                } else {
                    log(`❌ ${system.name} 未加载`, 'error');
                }
            });
        }

        // 检查函数定义
        function checkFunctions() {
            log('检查关键函数定义...');
            
            const functions = [
                'showNewPostModal',
                'showLoginPrompt', 
                'showNewLoginModal',
                'showNewRegisterModal',
                'initEventListeners',
                'loadDiscussions',
                'createModal',
                'showModal',
                'hideModal'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`✅ ${funcName} 函数已定义`, 'success');
                } else {
                    log(`❌ ${funcName} 函数未定义`, 'error');
                }
            });
        }

        // 清空日志
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
            log('日志已清空');
        }
    </script>
</body>
</html>