<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¤¾åŒºæŒ‰é’®æµ‹è¯• - ç³å‡¯è’‚äºšè¯­</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="community.css">
    <style>
        .test-container {
            max-width: 800px;
            margin: 120px auto 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            text-align: center;
        }
        
        .test-section {
            margin: 2rem 0;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .test-button {
            display: inline-block;
            margin: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(45deg, #ffd700, #4ecdc4);
            color: #1a1a2e;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            text-decoration: none;
            transition: all 0.3s ease;
        }
        
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.4);
        }
        
        .log-container {
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            text-align: left;
        }
        
        .log-item {
            margin: 0.5rem 0;
            padding: 0.5rem;
            border-left: 3px solid #ffd700;
            background: rgba(255, 255, 255, 0.05);
            font-family: monospace;
            font-size: 0.9rem;
        }
    </style>
</head>
<body>
    <div class="stars"></div>
    
    <!-- å¯¼èˆªæ  -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <div class="planet-icon"></div>
                <div class="logo-text">
                    <span class="logo-chinese">ç³å‡¯è’‚äºšè¯­ç¤¾åŒº</span>
                    <span class="logo-english">Community Test</span>
                </div>
            </div>
            <div class="nav-extras">
                <div class="auth-buttons">
                    <button class="btn btn-outline btn-small" id="loginBtn">ç™»å½•</button>
                    <button class="btn btn-primary btn-small" id="registerBtn">æ³¨å†Œ</button>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <div class="user-avatar" id="userAvatar"></div>
                    <span class="user-name" id="userName"></span>
                    <div class="user-dropdown">
                        <a href="#" id="profileLink">ä¸ªäººä¸­å¿ƒ</a>
                        <a href="#" id="logoutLink">é€€å‡º</a>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <div class="test-container">
        <h1>ğŸ§ª ç¤¾åŒºæŒ‰é’®åŠŸèƒ½æµ‹è¯•</h1>
        <p>æµ‹è¯•å„ä¸ªæŒ‰é’®æ˜¯å¦èƒ½æ­£å¸¸å·¥ä½œ</p>
        
        <div class="test-section">
            <h3>è®¤è¯ç³»ç»Ÿæµ‹è¯•</h3>
            <button class="test-button" onclick="testLogin()">æµ‹è¯•ç™»å½•</button>
            <button class="test-button" onclick="testRegister()">æµ‹è¯•æ³¨å†Œ</button>
            <button class="test-button" onclick="testLogout()">æµ‹è¯•é€€å‡º</button>
            <button class="test-button" onclick="checkAuthStatus()">æ£€æŸ¥è®¤è¯çŠ¶æ€</button>
        </div>
        
        <div class="test-section">
            <h3>ç¤¾åŒºåŠŸèƒ½æµ‹è¯•</h3>
            <button class="test-button" id="newPostBtn">å‘å¸ƒæ–°è¯é¢˜</button>
            <button class="test-button" onclick="testNewPostModal()">æµ‹è¯•å‘å¸ƒæ¨¡æ€æ¡†</button>
            <button class="test-button" onclick="testLoginPrompt()">æµ‹è¯•ç™»å½•æç¤º</button>
        </div>
        
        <div class="test-section">
            <h3>ç³»ç»Ÿæ£€æŸ¥</h3>
            <button class="test-button" onclick="checkSystems()">æ£€æŸ¥ç³»ç»ŸåŠ è½½</button>
            <button class="test-button" onclick="checkFunctions()">æ£€æŸ¥å‡½æ•°å®šä¹‰</button>
            <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        </div>
        
        <div class="log-container">
            <h4>ğŸ” æµ‹è¯•æ—¥å¿—</h4>
            <div id="testLog"></div>
        </div>
    </div>

    <!-- å¼•å…¥è„šæœ¬ -->
    <script src="auth-system.js"></script>
    <script src="community-system.js"></script>
    <script src="content-manager.js"></script>
    <script src="script.js"></script>
    <script src="community.js"></script>

    <script>
        // æ—¥å¿—è®°å½•å‡½æ•°
        function log(message, type = 'info') {
            const logDiv = document.getElementById('testLog');
            const timestamp = new Date().toLocaleTimeString();
            const icon = type === 'error' ? 'âŒ' : type === 'success' ? 'âœ…' : type === 'warning' ? 'âš ï¸' : 'â„¹ï¸';
            
            const logItem = document.createElement('div');
            logItem.className = 'log-item';
            logItem.innerHTML = `[${timestamp}] ${icon} ${message}`;
            
            logDiv.appendChild(logItem);
            logDiv.scrollTop = logDiv.scrollHeight;
            
            console.log(`[æµ‹è¯•] ${message}`);
        }

        // ç­‰å¾…é¡µé¢åŠ è½½å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            log('é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–æµ‹è¯•ç¯å¢ƒ');
            
            setTimeout(() => {
                checkSystems();
                checkFunctions();
                log('åˆå§‹åŒ–å®Œæˆï¼Œå¯ä»¥å¼€å§‹æµ‹è¯•');
            }, 1000);
        });

        // æµ‹è¯•ç™»å½•åŠŸèƒ½
        async function testLogin() {
            log('å¼€å§‹æµ‹è¯•ç™»å½•åŠŸèƒ½...');
            
            if (!window.authSystem) {
                log('è®¤è¯ç³»ç»ŸæœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•ç™»å½•', 'error');
                return;
            }
            
            try {
                // å°è¯•ç™»å½•æµ‹è¯•ç®¡ç†å‘˜è´¦æˆ·
                const result = await window.authSystem.login({
                    username: 'admin',
                    password: 'admin123'
                });
                
                if (result.success) {
                    log('ç™»å½•æµ‹è¯•æˆåŠŸï¼', 'success');
                    log(`å½“å‰ç”¨æˆ·: ${window.authSystem.currentUser.username}`);
                } else {
                    log(`ç™»å½•æµ‹è¯•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`ç™»å½•æµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•æ³¨å†ŒåŠŸèƒ½
        async function testRegister() {
            log('å¼€å§‹æµ‹è¯•æ³¨å†ŒåŠŸèƒ½...');
            
            if (!window.authSystem) {
                log('è®¤è¯ç³»ç»ŸæœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•æ³¨å†Œ', 'error');
                return;
            }
            
            try {
                const testUsername = 'test_' + Date.now();
                const result = await window.authSystem.register({
                    username: testUsername,
                    email: `${testUsername}@test.com`,
                    password: 'test123'
                });
                
                if (result.success) {
                    log('æ³¨å†Œæµ‹è¯•æˆåŠŸï¼', 'success');
                    log(`æ–°ç”¨æˆ·: ${testUsername}`);
                } else {
                    log(`æ³¨å†Œæµ‹è¯•å¤±è´¥: ${result.message}`, 'error');
                }
            } catch (error) {
                log(`æ³¨å†Œæµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æµ‹è¯•é€€å‡ºåŠŸèƒ½
        function testLogout() {
            log('å¼€å§‹æµ‹è¯•é€€å‡ºåŠŸèƒ½...');
            
            if (!window.authSystem) {
                log('è®¤è¯ç³»ç»ŸæœªåŠ è½½ï¼Œæ— æ³•æµ‹è¯•é€€å‡º', 'error');
                return;
            }
            
            try {
                const result = window.authSystem.logout();
                if (result.success) {
                    log('é€€å‡ºæµ‹è¯•æˆåŠŸï¼', 'success');
                } else {
                    log('é€€å‡ºæµ‹è¯•å¤±è´¥', 'error');
                }
            } catch (error) {
                log(`é€€å‡ºæµ‹è¯•å¼‚å¸¸: ${error.message}`, 'error');
            }
        }

        // æ£€æŸ¥è®¤è¯çŠ¶æ€
        function checkAuthStatus() {
            log('æ£€æŸ¥å½“å‰è®¤è¯çŠ¶æ€...');
            
            if (window.authSystem) {
                if (window.authSystem.currentUser) {
                    log(`âœ… å·²ç™»å½•ç”¨æˆ·: ${window.authSystem.currentUser.username} (${window.authSystem.currentUser.role})`, 'success');
                } else {
                    log('âš ï¸ ç”¨æˆ·æœªç™»å½•', 'warning');
                }
            } else {
                log('âŒ è®¤è¯ç³»ç»ŸæœªåŠ è½½', 'error');
            }
            
            if (window.communitySystem) {
                if (window.communitySystem.currentUser) {
                    log(`âœ… ç¤¾åŒºç³»ç»Ÿç”¨æˆ·: ${window.communitySystem.currentUser.username}`, 'success');
                } else {
                    log('âš ï¸ ç¤¾åŒºç³»ç»Ÿæ— ç”¨æˆ·', 'warning');
                }
            } else {
                log('âŒ ç¤¾åŒºç³»ç»ŸæœªåŠ è½½', 'error');
            }
        }

        // æµ‹è¯•å‘å¸ƒæ–°è¯é¢˜æ¨¡æ€æ¡†
        function testNewPostModal() {
            log('æµ‹è¯•å‘å¸ƒæ–°è¯é¢˜æ¨¡æ€æ¡†...');
            
            if (typeof showNewPostModal === 'function') {
                try {
                    showNewPostModal();
                    log('âœ… å‘å¸ƒæ¨¡æ€æ¡†å‡½æ•°è°ƒç”¨æˆåŠŸ', 'success');
                } catch (error) {
                    log(`âŒ å‘å¸ƒæ¨¡æ€æ¡†è°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âŒ showNewPostModal å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }

        // æµ‹è¯•ç™»å½•æç¤º
        function testLoginPrompt() {
            log('æµ‹è¯•ç™»å½•æç¤º...');
            
            if (typeof showLoginPrompt === 'function') {
                try {
                    showLoginPrompt();
                    log('âœ… ç™»å½•æç¤ºå‡½æ•°è°ƒç”¨æˆåŠŸ', 'success');
                } catch (error) {
                    log(`âŒ ç™»å½•æç¤ºè°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
                }
            } else {
                log('âŒ showLoginPrompt å‡½æ•°æœªå®šä¹‰', 'error');
            }
        }

        // æ£€æŸ¥ç³»ç»ŸåŠ è½½
        function checkSystems() {
            log('æ£€æŸ¥ç³»ç»ŸåŠ è½½çŠ¶æ€...');
            
            const systems = [
                { name: 'window.authSystem', obj: window.authSystem },
                { name: 'window.communitySystem', obj: window.communitySystem },
                { name: 'window.contentManager', obj: window.contentManager }
            ];
            
            systems.forEach(system => {
                if (system.obj) {
                    log(`âœ… ${system.name} å·²åŠ è½½`, 'success');
                } else {
                    log(`âŒ ${system.name} æœªåŠ è½½`, 'error');
                }
            });
        }

        // æ£€æŸ¥å‡½æ•°å®šä¹‰
        function checkFunctions() {
            log('æ£€æŸ¥å…³é”®å‡½æ•°å®šä¹‰...');
            
            const functions = [
                'showNewPostModal',
                'showLoginPrompt', 
                'showNewLoginModal',
                'showNewRegisterModal',
                'initEventListeners',
                'loadDiscussions',
                'createModal',
                'showModal',
                'hideModal'
            ];
            
            functions.forEach(funcName => {
                if (typeof window[funcName] === 'function') {
                    log(`âœ… ${funcName} å‡½æ•°å·²å®šä¹‰`, 'success');
                } else {
                    log(`âŒ ${funcName} å‡½æ•°æœªå®šä¹‰`, 'error');
                }
            });
        }

        // æ¸…ç©ºæ—¥å¿—
        function clearLog() {
            document.getElementById('testLog').innerHTML = '';
            log('æ—¥å¿—å·²æ¸…ç©º');
        }
    </script>
</body>
</html>